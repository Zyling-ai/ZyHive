import{d as Xe,r as C,P as Ye,T as ke,o as Qe,c as a,j as $,n as Ze,y as A,b as T,w as F,ad as et,e as l,t as m,F as D,p as N,g as f,f as B,q as tt,Q as st,k as ye,I as xe,S as W,ae as nt,X as te,af as lt,ag as ot,h as L,i as o,l as Ce,ah as ae,x as at}from"./index-CSEoj1Te.js";import{_ as it}from"./_plugin-vue_export-helper-DlAUqK2U.js";const rt={key:0,class:"drag-overlay"},ut={key:0,class:"running-tasks-banner"},ct={key:0,class:"resumed-list"},dt={key:0,class:"history-loading"},pt={key:1,class:"chat-empty"},ft={key:0,class:"welcome-msg"},ht={key:1,class:"examples"},vt=["onClick"],mt={key:0,class:"msg-row user"},gt={class:"msg-bubble user"},_t={key:0,class:"msg-images"},kt=["src","onClick"],yt={class:"msg-text"},xt={key:1,class:"msg-row assistant"},Ct={class:"msg-col"},bt=["open"],wt={class:"thinking-summary"},St={class:"thinking-len"},Tt={class:"thinking-content"},It={key:1,class:"tool-timeline"},$t=["onClick"],Dt={class:"tool-step-header"},Mt={key:0,class:"tool-spin"},jt={key:1},Nt={key:2},Ot={key:3},At={class:"tool-step-icon"},Ft={class:"tool-step-name"},Ut={key:0,class:"tool-step-summary"},Rt={key:1,class:"tool-step-dur"},Et={key:0},Bt={key:1},Lt={key:2},Pt={key:3},Jt={key:4},zt={class:"tool-step-chevron"},qt={key:0,class:"tool-section"},Ht={class:"tool-pre"},Kt={key:1,class:"tool-section"},Vt={class:"tool-pre result"},Wt=["src","onClick"],Gt=["href"],Xt={class:"tool-file-name"},Yt={class:"tool-file-size"},Qt={class:"msg-bubble assistant"},Zt={key:0,class:"no-model-card"},es={class:"no-model-body"},ts=["innerHTML"],ss={key:2,class:"apply-card"},ns={class:"apply-preview"},ls={class:"apply-key"},os={class:"apply-val"},as=["onClick"],is={class:"msg-actions"},rs=["onClick","title"],us=["onClick"],cs=["onClick"],ds={key:2,class:"option-chips"},ps=["onClick"],fs={key:2,class:"msg-row system"},hs={class:"msg-system"},vs={key:2,class:"msg-row assistant"},ms={class:"msg-col"},gs={key:0,class:"thinking-block",open:""},_s={class:"thinking-summary"},ks={class:"thinking-content"},ys={key:1,class:"tool-timeline"},xs=["onClick"],Cs={class:"tool-step-header"},bs={key:0,class:"tool-spin"},ws={key:1},Ss={key:2},Ts={class:"tool-step-icon"},Is={class:"tool-step-name"},$s={key:0,class:"tool-step-summary"},Ds={key:1,class:"tool-step-dur"},Ms={key:0},js={key:1},Ns={key:2},Os={key:3},As={key:4},Fs={class:"tool-step-chevron"},Us={key:0,class:"tool-section"},Rs={class:"tool-pre"},Es={key:1,class:"tool-section"},Bs={class:"tool-pre result"},Ls=["src","onClick"],Ps=["href"],Js={class:"tool-file-name"},zs={class:"tool-file-size"},qs={key:2,class:"msg-bubble assistant"},Hs={key:0,class:"typing-dots"},Ks=["innerHTML"],Vs={key:2,class:"blink"},Ws=["src"],Gs={class:"chat-input-area"},Xs={key:0,class:"attachments-bar"},Ys=["src"],Qs=["onClick"],Zs={class:"attach-file-icon"},en={class:"attach-file-name"},tn={class:"attach-file-size"},sn=["onClick"],nn={class:"input-row"},ln={class:"textarea-wrap"},on=["placeholder","disabled","onKeydown"],an={class:"input-actions"},rn={class:"icon-btn",title:"é™„åŠ æ–‡ä»¶ï¼ˆå›¾ç‰‡/ä»£ç /æ–‡æœ¬ï¼‰"},un=["disabled"],cn={key:0,class:"spinner"},dn={key:1},pn=Xe({__name:"AiChat",props:{agentId:{},sessionId:{},context:{},scenario:{},skillId:{},placeholder:{},welcomeMessage:{},examples:{default:()=>[]},showThinking:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},bgColor:{},height:{},initialMessages:{},applyable:{type:Boolean,default:!1}},emits:["message","response","apply","session-change","streaming-change"],setup(M,{expose:be,emit:we}){const x=M,P=we,g=C(x.initialMessages?[...x.initialMessages]:[]),J=C(""),U=C([]),R=C([]),_=C(!1);Ye(_,s=>P("streaming-change",s));const b=C(""),j=C(""),S=C([]),H=at(new Map),E=C([]);let I=null;const ie=xe(()=>{let s=0;for(const e of g.value)for(const n of e.toolCalls??[])n.taskId&&n.taskStatus&&!["done","error","killed"].includes(n.taskStatus)&&s++;return s+=E.value.filter(e=>!["done","error","killed"].includes(e.status)).length,s}),K=C(!1);let V=0;const G=C(null),X=C(""),k=C(x.sessionId),z=C(!1),Y=C(),O=C(),Se=xe(()=>({height:x.height??"100%","--bg":x.bgColor??"transparent"}));function re(){I||(I=setInterval(Te,3e3))}async function Te(){if(H.size===0&&E.value.every(u=>["done","error","killed"].includes(u.status))){I&&(clearInterval(I),I=null);return}const e=[];let n=!1;for(const[u,r]of H)try{const d=(await ae.get(r)).data;for(const t of g.value){const h=t.toolCalls?.find(i=>i.id===u);if(h){const i=!["done","error","killed"].includes(h.taskStatus??"");h.taskStatus=d.status,["done","error","killed"].includes(d.status)&&(e.push(u),i&&(n=!0))}}}catch{e.push(u),n=!0}for(const u of e)H.delete(u);let c=!1;for(const u of E.value)if(!["done","error","killed"].includes(u.status))try{const r=await ae.get(u.id),p=u.status;u.status=r.data.status,["done","error","killed"].includes(u.status)&&p!==u.status&&(c=!0)}catch{u.status="error",c=!0}if(!(H.size>0||E.value.some(u=>!["done","error","killed"].includes(u.status)))&&I&&(clearInterval(I),I=null),(c||n)&&k.value&&!_.value){const u=k.value;setTimeout(async()=>{if(!_.value&&k.value===u)try{const r=await te.get(x.agentId,u);if(_.value||k.value!==u)return;const p=r.data.messages??[],d=[];p.some(t=>t.isCompact||t.role==="compaction")&&d.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const t of p)t.role!=="compaction"&&d.push({role:t.role,text:t.text,toolCalls:t.toolCalls?.map(h=>({id:h.id,name:h.name,input:h.input,result:h.result,status:"done",_expanded:!1,...q(h.result??"")}))});g.value=d,y()}catch{}},1500)}}ke(()=>{I&&(clearInterval(I),I=null)});async function Ie(s){try{const n=(await ae.list({sessionId:s})).data,c=n.filter(u=>!["done","error","killed"].includes(u.status));if(n.filter(u=>["done","error","killed"].includes(u.status)).length>0&&setTimeout(async()=>{if(!_.value&&k.value===s)try{const u=await te.get(x.agentId,s);if(_.value||k.value!==s)return;const r=u.data.messages??[],p=[];r.some(d=>d.isCompact||d.role==="compaction")&&p.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const d of r)d.role!=="compaction"&&p.push({role:d.role,text:d.text,toolCalls:d.toolCalls?.map(t=>({id:t.id,name:t.name,input:t.input,result:t.result,status:"done",_expanded:!1,...q(t.result??"")}))});g.value=p,y()}catch{}},500),c.length===0)return;E.value=c.map(u=>({id:u.id,label:u.label||u.id.slice(0,8),status:u.status})),re()}catch{}}function y(){W(()=>{Y.value&&(Y.value.scrollTop=Y.value.scrollHeight)})}function $e(){O.value&&(O.value.style.height="auto",O.value.style.height=Math.min(O.value.scrollHeight,160)+"px")}function Q(s){J.value=s,W(()=>O.value?.focus())}function ue(s){try{return JSON.stringify(JSON.parse(s),null,2)}catch{return s}}function De(s){navigator.clipboard?.writeText(s);const e=g.value.findIndex(n=>n.text===s);G.value=e,setTimeout(()=>{G.value=null},1500)}function Me(s){for(let e=s-1;e>=0;e--){const n=g.value[e];if(n&&n.role==="user"){const c=n.text,v=n.images??[];g.value.splice(e,g.value.length-e),le(c,v);return}}}function se(s){X.value=s}function q(s){const e={};if(!s)return e;const n=s.match(/\[media:([^\]]+)\]/);if(n&&n[1]){const v=localStorage.getItem("aipanel_token")??"";e.mediaUrl=`/api/media?path=${encodeURIComponent(n[1])}&token=${encodeURIComponent(v)}`}const c=s.match(/\[file_card:([^|]+)\|([^|]+)\|([^\]]+)\]/);return c&&c[1]&&c[2]&&c[3]&&(e.fileCard={url:c[1],name:c[2],size:c[3]}),e}function ce(s){return s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/```(\w*)\n([\s\S]*?)```/g,(n,c,v)=>`<pre class="code-block${c?" lang-"+c:""}"><code>${v}</code></pre>`).replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>').replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/\[(.+?)\]\((https?:\/\/[^\)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>').replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/^[-*] (.+)$/gm,"<li>$1</li>").replace(/^\d+\. (.+)$/gm,"<li>$1</li>").replace(/(<li>[\s\S]+?<\/li>)(\n(?!<li>)|$)/g,"<ul>$1</ul>$2").replace(/([^>])\n([^<])/g,"$1<br>$2"):""}function je(s){const e=s.split(`
`),n=[],c=/^([ğŸ™ğŸ˜„ğŸŒğŸ›ğŸ“šğŸ¨ğŸ’¼ğŸ¤–âš½ğŸ¯âœ…âŒğŸ”¥ğŸ’¡ğŸğŸš€ğŸŒŸğŸ’ğŸªğŸ­ğŸ¬ğŸ¤]|[\u{1F300}-\u{1FFFF}]|[\u{2600}-\u{27BF}])\s+(.{4,40})/u;for(const v of e){const u=v.replace(/^[-*â€¢]\s*/,"").trim();if(u.match(c)){const p=u.replace(/[ï¼š:ã€‚ï¼Œ,]$/,"").trim();p.length>=5&&n.push(p)}}return n.slice(0,5)}function Ne(s){return s?/\{[\s\S]{30,}\}/.test(s)&&(s.includes('"name"')||s.includes('"identity"')||s.includes('"soul"')||s.includes('"IDENTITY"')||s.includes('"SOUL"')):!1}function Oe(s){const e=pe(s.text);e?(g.value.forEach(n=>{n!==s&&n.applyData&&delete n.applyData}),s.applyData=e,W(()=>P("apply",e))):alert("æœªèƒ½ä»æ¶ˆæ¯ä¸­æå–åˆ°é…ç½® JSONï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")}function de(s,e=0){const n=s.indexOf("{",e);if(n===-1)return null;let c=0,v=!1,u=!1;for(let r=n;r<s.length;r++){const p=s[r];if(u){u=!1;continue}if(p==="\\"&&v){u=!0;continue}if(p==='"'){v=!v;continue}if(!v){if(p==="{")c++;else if(p==="}"&&(c--,c===0))return{raw:s.slice(n,r+1),end:r+1}}}return null}function pe(s){const e=/```(?:json)?\s*\n?([\s\S]*?)```/g,n=[];let c;for(;(c=e.exec(s))!==null;){const r=(c[1]??"").trim();r.startsWith("{")&&n.push(r)}for(let r=n.length-1;r>=0;r--){const p=n[r],d=de(p);if(!d)continue;const t=Z(d.raw)??Z(fe(d.raw));if(t)return t}const v=[];let u=0;for(;u<s.length;){const r=de(s,u);if(!r)break;v.push(r.raw),u=r.end}for(let r=v.length-1;r>=0;r--){const p=v[r],d=Z(p)??Z(fe(p));if(d)return d}return null}function Z(s){try{const e=JSON.parse(s);if(e&&typeof e=="object"&&!Array.isArray(e)){const n=["name","id","description","identity","soul","IDENTITY","SOUL","NAME","DESCRIPTION"];if(Object.keys(e).some(c=>n.includes(c)))return e}}catch{}return null}function fe(s){let e="",n=!1,c=!1;for(let v=0;v<s.length;v++){const u=s[v];if(c){e+=u,c=!1;continue}if(u==="\\"&&n){e+=u,c=!0;continue}if(u==='"'){n=!n,e+=u;continue}if(n&&u===`
`){e+="\\n";continue}if(n&&u==="\r"){e+="\\r";continue}e+=u}return e}const Ae={exec:"âš¡",bash:"âš¡",read:"ğŸ“–",write:"âœï¸",edit:"âœï¸",web_search:"ğŸŒ",web_fetch:"ğŸŒ",browser:"ğŸŒ",agent_spawn:"ğŸš€",agent_tasks:"ğŸ“‹",agent_kill:"ğŸ›‘",agent_result:"ğŸ“Š",project_read:"ğŸ“",project_write:"ğŸ“",project_list:"ğŸ“",project_create:"ğŸ“",project_glob:"ğŸ“",memory_search:"ğŸ§ ",memory_get:"ğŸ§ ",image:"ğŸ–¼ï¸",tts:"ğŸ”Š",show_image:"ğŸ–¼ï¸",cron:"â±ï¸"};function he(s){return Ae[s]??"âš™ï¸"}function ve(s,e){try{const n=JSON.parse(e);if(s==="exec"||s==="bash")return(n.command??"").slice(0,60);if(s==="read")return n.file_path??n.path??"";if(s==="write")return(n.file_path??n.path??"")+(n.content?` (${n.content.length}B)`:"");if(s==="edit")return n.file_path??n.path??"";if(s==="web_search")return n.query??"";if(s==="web_fetch")return n.url??"";if(s==="agent_spawn")return`â†’ ${n.agentId}: ${(n.task??"").slice(0,40)}`;if(s==="project_read"||s==="project_write")return n.path??"";if(s==="memory_search")return n.query??"";if(s==="show_image")return(n.path??"").split("/").pop()??""}catch{}return""}const Fe=new Set(["txt","md","markdown","js","ts","jsx","tsx","vue","go","py","rs","java","kt","swift","html","css","scss","less","json","yaml","yml","toml","ini","cfg","env","sh","bash","zsh","fish","ps1","bat","cmd","dockerfile","makefile","sql","graphql","proto","xml","svg","gitignore","gitattributes"]);function me(s){const e=s.split(".").pop()?.toLowerCase()??"";return Fe.has(e)}function Ue(s){const e=s.split(".").pop()?.toLowerCase()??"";return{js:"ğŸŸ¨",ts:"ğŸ”µ",vue:"ğŸ’š",go:"ğŸ¹",py:"ğŸ",rs:"ğŸ¦€",html:"ğŸŒ",css:"ğŸ¨",json:"ğŸ“‹",md:"ğŸ“",sh:"âš¡",sql:"ğŸ—„ï¸",yaml:"âš™ï¸",yml:"âš™ï¸",dockerfile:"ğŸ³"}[e]??"ğŸ“„"}function Re(s){return s<1024?`${s}B`:s<1024*1024?`${(s/1024).toFixed(1)}KB`:`${(s/1024/1024).toFixed(1)}MB`}function Ee(s){const e=s.clipboardData?.items;if(e){for(const n of Array.from(e))if(n.type.startsWith("image/")){s.preventDefault();const c=n.getAsFile();c&&ne(c)}}}function Be(s){s.preventDefault(),V++,K.value=!0}function Le(s){s.preventDefault(),V--,V<=0&&(V=0,K.value=!1)}function Pe(s){V=0,K.value=!1;const e=s.dataTransfer?.files;if(e)for(const n of Array.from(e))n.type.startsWith("image/")?ne(n):me(n.name)&&ge(n)}function Je(s){const e=s.target.files;if(e){for(const n of Array.from(e))n.type.startsWith("image/")?ne(n):me(n.name)&&ge(n);s.target.value=""}}function ge(s){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&R.value.push({name:s.name,content:e.result})},e.readAsText(s)}function ne(s){const e=new FileReader;e.onload=()=>{typeof e.result=="string"&&U.value.push(e.result)},e.readAsDataURL(s)}function ze(s){U.value.splice(s,1)}function ee(){const s=J.value.trim(),e=[...U.value],n=[...R.value];if(!s&&!e.length&&!n.length||_.value)return;let c=s;if(n.length>0){const v=n.map(u=>{const r=u.name.split(".").pop()??"text";return`

ğŸ“ **${u.name}**
\`\`\`${r}
${u.content}
\`\`\``}).join("");c=s?s+v:v.trimStart()}J.value="",U.value=[],R.value=[],W(()=>{O.value&&(O.value.style.height="auto")}),P("message",c,e),le(c,e)}function le(s,e,n=!1){n||(g.value.push({role:"user",text:s,images:e.length?e:void 0}),y()),_.value=!0,b.value="",j.value="",S.value=[];const c={role:"assistant",text:"",toolCalls:[]};g.value.push(c),n&&y();const v=g.value.length-1;let u="",r;if(k.value)r=void 0;else{const d=g.value.slice(0,-1).filter(t=>(t.role==="user"||t.role==="assistant")&&t.text).slice(-20).map(t=>({role:t.role,content:t.text}));r=d.length>0?d:void 0}const p={sessionId:k.value,context:x.context,scenario:x.scenario,skillId:x.skillId,images:e.length?e:void 0,history:r};nt(x.agentId,s,d=>{switch(d.type){case"thinking_delta":j.value+=d.text,y();break;case"text":case"text_delta":b.value+=d.text,y();break;case"tool_call":{const t={id:d.tool_call?.id??String(Date.now()),name:d.tool_call?.name??"tool",input:d.tool_call?.input?JSON.stringify(d.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};g.value[v].toolCalls.push(t),S.value.push(t),u=t.id,y();break}case"tool_result":{const t=g.value[v].toolCalls?.find(h=>h.id===u);if(t){if(t.result=d.text,t.status="done",t._startedAt){const i=Date.now()-t._startedAt;t.duration=i<1e3?`${i}ms`:`${(i/1e3).toFixed(1)}s`}if(d.text&&Object.assign(t,q(d.text)),t.name==="agent_spawn"&&d.text){const i=d.text.match(/ä»»åŠ¡\s*ID[ï¼š:]\s*([a-f0-9-]{8,})/i);i&&(t.taskId=i[1],t.taskStatus="pending",H.set(u,i[1]),re())}const h=S.value.find(i=>i.id===u);h&&(h.result=t.result,h.status="done",h.duration=t.duration)}y();break}case"done":case"error":{if(d.type==="done"&&d.sessionId){const i=!k.value;k.value=d.sessionId,i&&P("session-change",d.sessionId)}const t=g.value[v];if(t.text=b.value,t.thinking=j.value||void 0,x.applyable){const i=pe(b.value);i&&(g.value.forEach(w=>{w!==t&&w.applyData&&delete w.applyData}),t.applyData=i)}const h=je(b.value);if(h.length>=2&&(t.options=h),d.type==="error"){d.error?.includes("no model configured")?(t.noModelError=!0,t.text=""):t.text=`[é”™è¯¯] ${d.error}`;const i=t.toolCalls?.find(w=>w.status==="running");i&&(i.status="error")}_.value=!1,b.value="",j.value="",S.value=[],P("response",t.text),y();break}}},p)}function qe(){g.value=[]}function He(s){g.value.push(s),y()}async function Ke(s){k.value=s,g.value=[],z.value=!0;const e=s;try{const n=await te.get(x.agentId,s);if(k.value!==e)return;const c=n.data.messages??[],v=[];c.some(r=>r.isCompact||r.role==="compaction")&&v.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const r of c)r.role!=="compaction"&&v.push({role:r.role,text:r.text,toolCalls:r.toolCalls?.map(p=>({id:p.id,name:p.name,input:p.input,result:p.result,status:"done",_expanded:!1}))});g.value=v,y(),Ie(s),_e(s)}catch(n){n?.response?.status===404?g.value=[]:(console.error("[AiChat] resumeSession failed",n),g.value=[{role:"system",text:"å†å²åŠ è½½å¤±è´¥ï¼Œç»§ç»­å¯¹è¯ä»å¯æ¥ç»­"}])}finally{z.value=!1}}async function _e(s){if(_.value)return;const e=await lt(x.agentId,s);if(k.value!==s||!e.hasWorker)return;if(e.status!=="generating"){const r=async()=>{if(!_.value)try{const p=await te.get(x.agentId,s);if(_.value||k.value!==s)return;const d=p.data.messages??[],t=[];d.some(h=>h.isCompact||h.role==="compaction")&&t.push({role:"system",text:"æ›´æ—©çš„å†…å®¹å·²å‹ç¼©"});for(const h of d)h.role!=="compaction"&&t.push({role:h.role,text:h.text,toolCalls:h.toolCalls?.map(i=>({id:i.id,name:i.name,input:i.input,result:i.result,status:"done",_expanded:!1,...q(i.result??"")}))});g.value=t,y()}catch{}};await r(),setTimeout(async()=>{_.value||k.value===s&&await r()},1e3);return}if(k.value!==s)return;_.value=!0,b.value="",j.value="",S.value=[];const n={role:"assistant",text:"",toolCalls:[]};g.value.push(n);const c=g.value.length-1;y();let v="";const u=ot(x.agentId,s,r=>{switch(r.type){case"idle":g.value.splice(c,1),_.value=!1;break;case"thinking_delta":j.value+=r.text,y();break;case"text":case"text_delta":b.value+=r.text,y();break;case"tool_call":{const p={id:r.tool_call?.id??String(Date.now()),name:r.tool_call?.name??"tool",input:r.tool_call?.input?JSON.stringify(r.tool_call.input):void 0,status:"running",_startedAt:Date.now(),_expanded:!1};g.value[c].toolCalls.push(p),S.value.push(p),v=p.id,y();break}case"tool_result":{const p=g.value[c].toolCalls?.find(d=>d.id===v);if(p){p.result=r.text,p.status="done",r.text&&Object.assign(p,q(r.text));const d=S.value.find(t=>t.id===v);d&&(d.result=p.result,d.status="done",Object.assign(d,q(r.text??"")))}y();break}case"done":case"error":{if(r.type==="done"&&r.sessionId){const d=!k.value;k.value=r.sessionId,d&&P("session-change",r.sessionId)}const p=g.value[c];p.text=b.value,p.thinking=j.value||void 0,r.type==="error"&&(r.error?.includes("no model configured")?(p.noModelError=!0,p.text=""):p.text=`[é”™è¯¯] ${r.error}`),_.value=!1,b.value="",j.value="",S.value=[],y();break}}});ke(()=>u.abort())}function Ve(){k.value=void 0,g.value=[]}function We(s){Q(s),W(ee)}function Ge(s){le(s,[],!0)}return be({clearMessages:qe,appendMessage:He,sendText:We,sendSilent:Ge,fillInput:Q,messages:g,streaming:_,currentSessionId:k,resumeSession:Ke,startNewSession:Ve}),Qe(()=>{y(),k.value&&_e(k.value)}),(s,e)=>{const n=L("ChatRound"),c=L("el-icon"),v=L("router-link"),u=L("Check"),r=L("CopyDocument"),p=L("Setting"),d=L("Paperclip");return o(),a("div",{class:A(["ai-chat",{compact:M.compact,"has-bg":M.bgColor,"drag-active":K.value}]),style:Ze(Se.value),onDragenter:$(Be,["prevent"]),onDragover:e[8]||(e[8]=$(()=>{},["prevent"])),onDragleave:Le,onDrop:$(Pe,["prevent","stop"])},[T(et,{name:"drag-fade"},{default:F(()=>[K.value?(o(),a("div",rt,[...e[9]||(e[9]=[l("div",{class:"drag-overlay-content"},[l("div",{class:"drag-overlay-icon"},"ğŸ“"),l("div",{class:"drag-overlay-title"},"æ¾å¼€ä»¥é™„åŠ æ–‡ä»¶"),l("div",{class:"drag-overlay-hint"},"æ”¯æŒå›¾ç‰‡ Â· ä»£ç  Â· æ–‡æœ¬æ–‡ä»¶")],-1)])])):f("",!0)]),_:1}),ie.value>0?(o(),a("div",ut,[e[10]||(e[10]=l("span",{class:"running-dot"},null,-1)),l("span",null,"åå°æœ‰ "+m(ie.value)+" ä¸ªä»»åŠ¡æ­£åœ¨æ‰§è¡Œä¸­ï¼Œå…³é—­çª—å£åä»ä¼šç»§ç»­è¿è¡Œ",1),E.value.length?(o(),a("span",ct,[(o(!0),a(D,null,N(E.value.filter(t=>!["done","error","killed"].includes(t.status)),t=>(o(),a("span",{key:t.id,class:A(["resumed-chip",t.status])},m(t.status==="running"?"âŸ³":"ğŸŸ¡")+" "+m(t.label),3))),128))])):f("",!0)])):f("",!0),l("div",{class:"chat-messages",ref_key:"msgListRef",ref:Y},[z.value?(o(),a("div",dt,[...e[11]||(e[11]=[l("div",{class:"history-loading-dots"},[l("span"),l("span"),l("span")],-1),l("div",{class:"history-loading-text"},"åŠ è½½å†å²å¯¹è¯â€¦",-1)])])):f("",!0),!g.value.length&&!z.value?(o(),a("div",pt,[M.welcomeMessage?(o(),a("div",ft,m(M.welcomeMessage),1)):f("",!0),M.examples.length?(o(),a("div",ht,[(o(!0),a(D,null,N(M.examples,(t,h)=>(o(),a("div",{key:h,class:"example-chip",onClick:i=>Q(t)},m(t),9,vt))),128))])):f("",!0)])):f("",!0),(o(!0),a(D,null,N(_.value?g.value.slice(0,-1):g.value,(t,h)=>(o(),a(D,{key:h},[t.role==="user"?(o(),a("div",mt,[l("div",gt,[t.images?.length?(o(),a("div",_t,[(o(!0),a(D,null,N(t.images,(i,w)=>(o(),a("img",{key:w,src:i,class:"msg-img",onClick:oe=>se(i)},null,8,kt))),128))])):f("",!0),l("div",yt,m(t.text),1)])])):t.role==="assistant"?(o(),a("div",xt,[l("div",Ct,[t.thinking?(o(),a("details",{key:0,class:"thinking-block",open:M.showThinking},[l("summary",wt,[T(c,{class:"thinking-icon"},{default:F(()=>[T(n)]),_:1}),e[12]||(e[12]=B(" æ€è€ƒè¿‡ç¨‹ ",-1)),l("span",St,m(t.thinking.length)+" å­—ç¬¦",1)]),l("pre",Tt,m(t.thinking),1)],8,bt)):f("",!0),t.toolCalls?.length?(o(),a("div",It,[(o(!0),a(D,null,N(t.toolCalls,(i,w)=>(o(),a("div",{key:w,class:A(["tool-step",i.status]),onClick:oe=>i._expanded=!i._expanded},[l("div",Dt,[l("span",{class:A(["tool-step-dot",i.status])},[i.status==="running"?(o(),a("span",Mt,"âŸ³")):i.status==="done"?(o(),a("span",jt,"âœ“")):i.status==="error"?(o(),a("span",Nt,"âœ—")):(o(),a("span",Ot,"â—‹"))],2),l("span",At,m(he(i.name)),1),l("code",Ft,m(i.name),1),i.input?(o(),a("span",Ut,m(ve(i.name,i.input)),1)):f("",!0),e[14]||(e[14]=l("span",{class:"tool-step-flex"},null,-1)),i.duration?(o(),a("span",Rt,m(i.duration),1)):f("",!0),i.taskId?(o(),a("span",{key:2,class:A(["task-badge",i.taskStatus])},[i.taskStatus==="pending"?(o(),a("span",Et,"ğŸŸ¡ æ’é˜Ÿä¸­")):i.taskStatus==="running"?(o(),a("span",Bt,[...e[13]||(e[13]=[l("span",{class:"tool-spin"},"âŸ³",-1),B(" æ‰§è¡Œä¸­ ",-1)])])):i.taskStatus==="done"?(o(),a("span",Lt,"âœ… å®Œæˆ")):i.taskStatus==="error"?(o(),a("span",Pt,"âŒ å¤±è´¥")):i.taskStatus==="killed"?(o(),a("span",Jt,"ğŸ›‘ å·²ç»ˆæ­¢")):f("",!0)],2)):f("",!0),l("span",zt,m(i._expanded?"â–²":"â–¼"),1)]),i._expanded?(o(),a("div",{key:0,class:"tool-step-body",onClick:e[0]||(e[0]=$(()=>{},["stop"]))},[i.input?(o(),a("div",qt,[e[15]||(e[15]=l("div",{class:"tool-label"},"INPUT",-1)),l("pre",Ht,m(ue(i.input)),1)])):f("",!0),i.result?(o(),a("div",Kt,[e[16]||(e[16]=l("div",{class:"tool-label"},"OUTPUT",-1)),l("pre",Vt,m(i.result.slice(0,3e3))+m(i.result.length>3e3?`
â€¦ (æˆªæ–­)`:""),1)])):f("",!0)])):f("",!0),i.mediaUrl?(o(),a("div",{key:1,class:"tool-media-preview",onClick:e[1]||(e[1]=$(()=>{},["stop"]))},[l("img",{src:i.mediaUrl,class:"tool-media-img",onClick:oe=>se(i.mediaUrl)},null,8,Wt)])):f("",!0),i.fileCard?(o(),a("div",{key:2,class:"tool-file-card",onClick:e[2]||(e[2]=$(()=>{},["stop"]))},[l("a",{href:i.fileCard.url,target:"_blank",download:"",class:"tool-file-link"},[e[17]||(e[17]=l("span",{class:"tool-file-icon"},"ğŸ“",-1)),l("span",Xt,m(i.fileCard.name),1),l("span",Yt,m(i.fileCard.size),1),e[18]||(e[18]=l("span",{class:"tool-file-dl"},"â†“ ä¸‹è½½",-1))],8,Gt)])):f("",!0)],10,$t))),128))])):f("",!0),l("div",Qt,[t.noModelError?(o(),a("div",Zt,[e[22]||(e[22]=l("div",{class:"no-model-icon"},"ğŸ¤–",-1)),l("div",es,[e[20]||(e[20]=l("div",{class:"no-model-title"},"è¿˜æ²¡æœ‰é…ç½® AI æ¨¡å‹",-1)),e[21]||(e[21]=l("div",{class:"no-model-desc"},"éœ€è¦å…ˆæ·»åŠ ä¸€ä¸ªæ¨¡å‹ï¼ˆå¦‚ Claudeã€GPT-4 ç­‰ï¼‰å¹¶å¡«å†™ API Keyï¼Œæ‰èƒ½å¼€å§‹å¯¹è¯ã€‚",-1)),T(v,{to:"/models",class:"no-model-btn"},{default:F(()=>[...e[19]||(e[19]=[B("å»é…ç½®æ¨¡å‹ â†’",-1)])]),_:1})])])):t.text?(o(),a("div",{key:1,class:"msg-text",innerHTML:ce(t.text)},null,8,ts)):f("",!0),t.applyData&&x.applyable?(o(),a("div",ss,[l("div",ns,[(o(!0),a(D,null,N(t.applyData,(i,w)=>(o(),a("div",{key:w,class:"apply-row"},[l("span",ls,m(w),1),l("span",os,m(String(i).slice(0,60))+m(String(i).length>60?"â€¦":""),1)]))),128))]),l("button",{class:"apply-btn",onClick:i=>s.$emit("apply",t.applyData)}," åº”ç”¨åˆ°è¡¨å• â†™ ",8,as)])):f("",!0),l("div",is,[l("button",{class:"act-btn",onClick:i=>De(t.text),title:G.value===h?"å·²å¤åˆ¶":"å¤åˆ¶"},[G.value===h?(o(),Ce(c,{key:0},{default:F(()=>[T(u)]),_:1})):(o(),Ce(c,{key:1},{default:F(()=>[T(r)]),_:1}))],8,rs),l("button",{class:"act-btn",onClick:i=>Me(h),title:"é‡è¯•"},"â†º",8,us),x.applyable&&!t.applyData&&Ne(t.text)?(o(),a("button",{key:0,class:"act-btn apply-manual-btn",onClick:i=>Oe(t),title:"æ£€æµ‹åˆ°é…ç½® JSONï¼Œç‚¹å‡»åº”ç”¨"},[T(c,null,{default:F(()=>[T(p)]),_:1}),e[23]||(e[23]=B(" åº”ç”¨é…ç½® ",-1))],8,cs)):f("",!0)])]),t.options&&t.options.length?(o(),a("div",ds,[(o(!0),a(D,null,N(t.options,(i,w)=>(o(),a("button",{key:w,class:"option-chip",onClick:oe=>Q(i)},m(i),9,ps))),128))])):f("",!0)])])):t.role==="system"?(o(),a("div",fs,[l("div",hs,m(t.text),1)])):f("",!0)],64))),128)),_.value?(o(),a("div",vs,[l("div",ms,[j.value&&M.showThinking?(o(),a("details",gs,[l("summary",_s,[T(c,{class:"thinking-icon"},{default:F(()=>[T(n)]),_:1}),e[24]||(e[24]=B(" æ€è€ƒä¸­â€¦ ",-1))]),l("pre",ks,[B(m(j.value),1),e[25]||(e[25]=l("span",{class:"blink"},"â–Š",-1))])])):f("",!0),S.value.length?(o(),a("div",ys,[(o(!0),a(D,null,N(S.value,(t,h)=>(o(),a("div",{key:h,class:A(["tool-step",t.status]),onClick:i=>t._expanded=!t._expanded},[l("div",Cs,[l("span",{class:A(["tool-step-dot",t.status])},[t.status==="running"?(o(),a("span",bs,"âŸ³")):t.status==="done"?(o(),a("span",ws,"âœ“")):t.status==="error"?(o(),a("span",Ss,"âœ—")):f("",!0)],2),l("span",Ts,m(he(t.name)),1),l("code",Is,m(t.name),1),t.input?(o(),a("span",$s,m(ve(t.name,t.input)),1)):f("",!0),e[27]||(e[27]=l("span",{class:"tool-step-flex"},null,-1)),t.duration?(o(),a("span",Ds,m(t.duration),1)):f("",!0),t.taskId?(o(),a("span",{key:2,class:A(["task-badge",t.taskStatus])},[t.taskStatus==="pending"?(o(),a("span",Ms,"ğŸŸ¡ æ’é˜Ÿä¸­")):t.taskStatus==="running"?(o(),a("span",js,[...e[26]||(e[26]=[l("span",{class:"tool-spin"},"âŸ³",-1),B(" æ‰§è¡Œä¸­",-1)])])):t.taskStatus==="done"?(o(),a("span",Ns,"âœ… å®Œæˆ")):t.taskStatus==="error"?(o(),a("span",Os,"âŒ å¤±è´¥")):t.taskStatus==="killed"?(o(),a("span",As,"ğŸ›‘ å·²ç»ˆæ­¢")):f("",!0)],2)):f("",!0),l("span",Fs,m(t._expanded?"â–²":"â–¼"),1)]),t._expanded?(o(),a("div",{key:0,class:"tool-step-body",onClick:e[3]||(e[3]=$(()=>{},["stop"]))},[t.input?(o(),a("div",Us,[e[28]||(e[28]=l("div",{class:"tool-label"},"INPUT",-1)),l("pre",Rs,m(ue(t.input)),1)])):f("",!0),t.result?(o(),a("div",Es,[e[29]||(e[29]=l("div",{class:"tool-label"},"OUTPUT",-1)),l("pre",Bs,m(t.result.slice(0,3e3)),1)])):f("",!0)])):f("",!0),t.mediaUrl?(o(),a("div",{key:1,class:"tool-media-preview",onClick:e[4]||(e[4]=$(()=>{},["stop"]))},[l("img",{src:t.mediaUrl,class:"tool-media-img",onClick:i=>se(t.mediaUrl)},null,8,Ls)])):f("",!0),t.fileCard?(o(),a("div",{key:2,class:"tool-file-card",onClick:e[5]||(e[5]=$(()=>{},["stop"]))},[l("a",{href:t.fileCard.url,target:"_blank",download:"",class:"tool-file-link"},[e[30]||(e[30]=l("span",{class:"tool-file-icon"},"ğŸ“",-1)),l("span",Js,m(t.fileCard.name),1),l("span",zs,m(t.fileCard.size),1),e[31]||(e[31]=l("span",{class:"tool-file-dl"},"â†“ ä¸‹è½½",-1))],8,Ps)])):f("",!0)],10,xs))),128))])):f("",!0),b.value||!S.value.length?(o(),a("div",qs,[!b.value&&!S.value.length?(o(),a("div",Hs,[...e[32]||(e[32]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1)])])):f("",!0),b.value?(o(),a("div",{key:1,class:"msg-text",innerHTML:ce(b.value)},null,8,Ks)):f("",!0),b.value?(o(),a("span",Vs,"â–Š")):f("",!0)])):f("",!0)])])):f("",!0)],512),X.value?(o(),a("div",{key:1,class:"img-preview-mask",onClick:e[6]||(e[6]=t=>X.value="")},[l("img",{src:X.value,class:"img-preview-full"},null,8,Ws)])):f("",!0),l("div",Gs,[U.value.length||R.value.length?(o(),a("div",Xs,[(o(!0),a(D,null,N(U.value,(t,h)=>(o(),a("div",{key:"img-"+h,class:"attach-thumb"},[l("img",{src:t},null,8,Ys),l("button",{class:"remove-attach",onClick:i=>ze(h)},"Ã—",8,Qs)]))),128)),(o(!0),a(D,null,N(R.value,(t,h)=>(o(),a("div",{key:"file-"+h,class:"attach-file-chip"},[l("span",Zs,m(Ue(t.name)),1),l("span",en,m(t.name),1),l("span",tn,m(Re(t.content.length)),1),l("button",{class:"attach-file-remove",onClick:i=>R.value.splice(h,1)},"Ã—",8,sn)]))),128))])):f("",!0),l("div",nn,[l("div",ln,[tt(l("textarea",{ref_key:"inputRef",ref:O,"onUpdate:modelValue":e[7]||(e[7]=t=>J.value=t),placeholder:M.placeholder||"è¾“å…¥æ¶ˆæ¯â€¦ æ”¯æŒæ‹–æ‹½å›¾ç‰‡æˆ–æ–‡ä»¶ (Ctrl+Enter å‘é€)",disabled:_.value||z.value,rows:"1",class:"chat-textarea",onKeydown:[ye($(ee,["ctrl","prevent"]),["enter"]),ye($(ee,["meta","prevent"]),["enter"])],onPaste:Ee,onInput:$e},null,40,on),[[st,J.value]])]),l("div",an,[l("label",rn,[T(c,null,{default:F(()=>[T(d)]),_:1}),l("input",{type:"file",multiple:"",hidden:"",onChange:Je},null,32)]),l("button",{class:"send-btn",disabled:_.value||z.value||!J.value.trim()&&!U.value.length&&!R.value.length,onClick:ee},[_.value?(o(),a("span",cn)):(o(),a("span",dn,"â†‘"))],8,un)])]),e[33]||(e[33]=l("div",{class:"input-hint"},"Ctrl+Enter å‘é€ Â· æ”¯æŒæ‹–æ‹½å›¾ç‰‡/æ–‡ä»¶",-1))])],38)}}}),vn=it(pn,[["__scopeId","data-v-8ecfa3d2"]]);export{vn as A};
