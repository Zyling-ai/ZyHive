import{d as he,o as we,T as Te,z as Ve,ae as B,E as k,c as r,e as a,b as s,w as d,g as m,F as b,p as D,n as h,y as C,f as c,t as i,l as x,r as p,I as ie,h as _,i as u,m as g,a1 as Ie,K as F,a8 as Z,af as Ce,ag as ze,ad as Be}from"./index-B0OC2w2j.js";import{A as xe}from"./AiChat-BMiAtqDQ.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ae={class:"dispatch-studio"},Le={class:"sidebar-top"},Ue={class:"sidebar-acts"},Ee={class:"ds-filter"},Se={class:"task-list"},Ne={key:0,class:"list-empty"},De=["onClick"],Fe={class:"ti-info"},Re={class:"ti-name-row"},We={class:"ti-name"},Xe={class:"ti-label"},$e={class:"ti-meta"},Ke={class:"ti-type"},Pe={class:"ti-time"},je={class:"ds-editor"},qe={key:0,class:"editor-empty"},Ge={class:"editor-toolbar"},He={class:"editor-breadcrumb"},Je={class:"crumb-name"},Oe={class:"toolbar-acts"},Qe={class:"editor-form"},Ye={class:"form-group"},Ze={class:"form-group"},ea={class:"agent-opt"},aa={class:"form-group"},la={class:"form-label"},ta={class:"agent-opt"},sa={key:0,style:{padding:"8px 12px","font-size":"12px",color:"#94a3b8"}},na={class:"agent-opt"},oa={class:"form-group"},da={class:"form-group form-grow"},ia={class:"form-label"},ua={class:"form-group"},ra={class:"editor-toolbar"},va={class:"editor-breadcrumb"},ca={class:"crumb-sep"},pa={class:"crumb-name"},ma={class:"toolbar-acts"},fa={class:"detail-body"},_a={class:"detail-status-bar"},ga={class:"ds-badge"},ya={key:0,class:"ds-badge"},ka={key:1,class:"ds-badge ds-badge-model"},ba={key:0,class:"detail-chain"},ha={class:"chain-from"},wa={class:"chain-arrow"},Ta={class:"chain-to"},Va={class:"detail-times"},Ia={class:"dt-item"},Ca={class:"dt-val"},za={key:0,class:"dt-item"},Ba={class:"dt-val"},xa={key:1,class:"dt-item"},Ma={class:"dt-val"},Aa={class:"dt-item"},La={class:"dt-val"},Ua={class:"detail-section"},Ea={class:"section-content task-desc"},Sa={key:1,class:"detail-section"},Na={class:"section-content error-content"},Da={key:2,class:"detail-section detail-output"},Fa={class:"section-content output-content"},Ra={class:"chat-panel-head"},Wa={key:0,class:"chat-live-dot"},Xa={class:"chat-wrap"},$a={key:0,class:"chat-empty"},Ka=he({__name:"SubagentsView",setup(Pa){const w=p([]),M=p([]),A=p(!1),R=p(!1),W=p(!1),t=p(null),T=p(!1),X=p(260),$=p(400),V=p(""),L=p(""),U=p(""),o=p({agentId:"",spawnedBy:"",taskType:"task",task:"",label:"",model:""}),z=p([]),E=p(!1);let K=null;const ee=ie(()=>{let l=[...w.value].sort((e,v)=>v.createdAt-e.createdAt);return L.value&&(l=l.filter(e=>e.status===L.value)),U.value&&(l=l.filter(e=>e.taskType===U.value)),l}),P=ie(()=>{const l={};return M.value.forEach(e=>{l[e.id]=e}),l});we(async()=>{await Promise.all([ue(),S()]),K=setInterval(()=>{w.value.some(e=>e.status==="running"||e.status==="pending")&&S(!0)},5e3)}),Te(()=>{K&&clearInterval(K),document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",H)});async function ue(){try{const l=await Ve.list();M.value=l.data.filter(e=>!e.system)}catch{}}async function S(l=!1){l||(A.value=!0);try{const e=await B.list();if(w.value=e.data,t.value){const v=e.data.find(y=>y.id===t.value.id);v&&(t.value=v)}}catch{l||k.error("åŠ è½½ä»»åŠ¡å¤±è´¥")}finally{A.value=!1}}function re(l){t.value=l,T.value=!1}function j(){T.value=!0,t.value=null,o.value={agentId:"",spawnedBy:"",taskType:"task",task:"",label:"",model:""},z.value=[]}async function ae(){if(o.value.agentId="",z.value=[],!!o.value.spawnedBy){E.value=!0;try{const l=await B.eligibleTargets(o.value.spawnedBy,o.value.taskType);z.value=l.data}catch{}finally{E.value=!1}}}async function ve(){o.value.spawnedBy&&await ae()}async function ce(){if(!o.value.agentId){k.warning("è¯·é€‰æ‹©ç›®æ ‡æˆå‘˜");return}if(!o.value.task.trim()){k.warning(o.value.taskType==="task"?"è¯·å¡«å†™ä»»åŠ¡æè¿°":"è¯·å¡«å†™æ±‡æŠ¥å†…å®¹");return}R.value=!0;try{const l=await B.spawn({agentId:o.value.agentId,task:o.value.task,label:o.value.label||void 0,model:o.value.model||void 0,spawnedBy:o.value.spawnedBy||void 0,taskType:o.value.taskType});k.success("æ´¾é£æˆåŠŸ"),w.value.unshift(l.data),T.value=!1,t.value=l.data}catch(l){k.error(l?.response?.data?.error||"æ´¾é£å¤±è´¥")}finally{R.value=!1}}async function pe(){if(t.value){W.value=!0;try{await B.kill(t.value.id),k.success("ä»»åŠ¡å·²ç»ˆæ­¢"),await S()}catch{k.error("ç»ˆæ­¢å¤±è´¥")}finally{W.value=!1}}}async function me(){if(t.value){try{await B.kill(t.value.id)}catch{}w.value=w.value.filter(l=>l.id!==t.value.id),t.value=null}}let le=0,q=0;function te(l,e){V.value=e,le=l.clientX,q=e==="side"?X.value:$.value,document.addEventListener("mousemove",G),document.addEventListener("mouseup",H),l.preventDefault()}function G(l){const e=l.clientX-le;V.value==="side"?X.value=Math.max(200,Math.min(400,q+e)):V.value==="chat"&&($.value=Math.max(280,Math.min(600,q-e)))}function H(){V.value="",document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",H)}function I(l){return P.value[l]?.name||l}function J(l){return P.value[l]?.avatarColor||"#6366f1"}function se(l){return(P.value[l]?.name||l)[0]?.toUpperCase()||"?"}function ne(l){return{pending:"ç­‰å¾…ä¸­",running:"æ‰§è¡Œä¸­",done:"å·²å®Œæˆ",error:"å‡ºé”™",killed:"å·²ç»ˆæ­¢"}[l]??l}function oe(l){return{task:"æ´¾é£",report:"æ±‡æŠ¥",system:"ç³»ç»Ÿ"}[l??""]??"ä»»åŠ¡"}function O(l,e){return l&&l.length>e?l.slice(0,e)+"â€¦":l||""}function Q(l){return l?new Date(l).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"â€”"}function fe(l){const e=Date.now()-l;return e<6e4?"åˆšåˆš":e<36e5?Math.floor(e/6e4)+"åˆ†é’Ÿå‰":e<864e5?Math.floor(e/36e5)+"å°æ—¶å‰":Math.floor(e/864e5)+"å¤©å‰"}return(l,e)=>{const v=_("el-icon"),y=_("el-button"),f=_("el-option"),N=_("el-select"),de=_("el-radio-button"),_e=_("el-radio-group"),ge=_("el-tag"),Y=_("el-input"),ye=_("el-collapse-item"),ke=_("el-collapse"),be=_("el-popconfirm");return u(),r("div",Ae,[a("div",{class:"ds-sidebar",style:h({width:X.value+"px"})},[a("div",Le,[e[11]||(e[11]=a("span",{class:"sidebar-title"},"æ´¾é£ä»»åŠ¡",-1)),a("div",Ue,[s(y,{size:"small",loading:A.value,circle:"",onClick:S},{default:d(()=>[s(v,null,{default:d(()=>[s(g(Ie))]),_:1})]),_:1},8,["loading"]),s(y,{size:"small",type:"primary",circle:"",onClick:j},{default:d(()=>[s(v,null,{default:d(()=>[s(g(F))]),_:1})]),_:1})])]),a("div",Ee,[s(N,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=n=>L.value=n),placeholder:"çŠ¶æ€",clearable:"",size:"small",class:"filter-sel"},{default:d(()=>[s(f,{label:"è¿è¡Œä¸­",value:"running"}),s(f,{label:"å·²å®Œæˆ",value:"done"}),s(f,{label:"å‡ºé”™",value:"error"}),s(f,{label:"å·²ç»ˆæ­¢",value:"killed"}),s(f,{label:"ç­‰å¾…ä¸­",value:"pending"})]),_:1},8,["modelValue"]),s(N,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=n=>U.value=n),placeholder:"ç±»å‹",clearable:"",size:"small",class:"filter-sel"},{default:d(()=>[s(f,{label:"æ´¾é£",value:"task"}),s(f,{label:"æ±‡æŠ¥",value:"report"}),s(f,{label:"ç³»ç»Ÿ",value:"system"})]),_:1},8,["modelValue"])]),a("div",Se,[!A.value&&ee.value.length===0?(u(),r("div",Ne,"æš‚æ— ä»»åŠ¡")):m("",!0),(u(!0),r(b,null,D(ee.value,n=>(u(),r("div",{key:n.id,class:C(["task-item",{active:t.value?.id===n.id}]),onClick:ja=>re(n)},[a("div",{class:C(["ti-avatar",{"ti-avatar-running":n.status==="running"}]),style:h({background:J(n.agentId)})},i(se(n.agentId)),7),a("div",Fe,[a("div",Re,[a("span",We,i(I(n.agentId)),1),a("span",{class:C(["ti-tag","tag-"+n.status])},i(ne(n.status)),3)]),a("div",Xe,i(n.label||O(n.task,36)),1),a("div",$e,[a("span",Ke,i(oe(n.taskType)),1),a("span",Pe,i(fe(n.createdAt)),1)])])],10,De))),128))])],4),a("div",{class:C(["ds-handle",{dragging:V.value==="side"}]),onMousedown:e[2]||(e[2]=n=>te(n,"side"))},[...e[12]||(e[12]=[a("div",{class:"ds-handle-bar"},null,-1)])],34),a("div",je,[!t.value&&!T.value?(u(),r("div",qe,[s(v,{size:"48",color:"#c0c4cc"},{default:d(()=>[s(g(Z))]),_:1}),e[14]||(e[14]=a("p",null,[c("ä»å·¦ä¾§é€‰æ‹©ä»»åŠ¡æŸ¥çœ‹è¯¦æƒ…"),a("br"),c("æˆ–æ–°å»ºæ´¾é£")],-1)),s(y,{type:"primary",onClick:j},{default:d(()=>[s(v,null,{default:d(()=>[s(g(F))]),_:1}),e[13]||(e[13]=c(" æ–°å»ºæ´¾é£",-1))]),_:1})])):T.value?(u(),r(b,{key:1},[a("div",Ge,[a("div",He,[s(v,{style:{color:"#909399"}},{default:d(()=>[s(g(F))]),_:1}),e[15]||(e[15]=a("span",{class:"crumb-sep"},"æ–°å»º",-1)),a("span",Je,i(o.value.taskType==="task"?"æ´¾é£ä»»åŠ¡":"å‘èµ·æ±‡æŠ¥"),1)]),a("div",Oe,[s(y,{size:"small",onClick:e[3]||(e[3]=n=>{T.value=!1,t.value=null})},{default:d(()=>[...e[16]||(e[16]=[c("å–æ¶ˆ",-1)])]),_:1}),s(y,{size:"small",type:"primary",loading:R.value,onClick:ce},{default:d(()=>[s(v,null,{default:d(()=>[s(g(Ce))]),_:1}),c(" "+i(o.value.taskType==="task"?"æ´¾é£":"æ±‡æŠ¥"),1)]),_:1},8,["loading"])])]),a("div",Qe,[a("div",Ye,[e[19]||(e[19]=a("label",{class:"form-label"},"ç±»å‹",-1)),s(_e,{modelValue:o.value.taskType,"onUpdate:modelValue":e[4]||(e[4]=n=>o.value.taskType=n),size:"small",onChange:ve},{default:d(()=>[s(de,{value:"task"},{default:d(()=>[...e[17]||(e[17]=[c("ğŸš€ æ´¾é£ä»»åŠ¡",-1)])]),_:1}),s(de,{value:"report"},{default:d(()=>[...e[18]||(e[18]=[c("ğŸ“‹ å‘èµ·æ±‡æŠ¥",-1)])]),_:1})]),_:1},8,["modelValue"])]),a("div",Ze,[e[20]||(e[20]=a("label",{class:"form-label"},"å‘èµ·æˆå‘˜",-1)),s(N,{modelValue:o.value.spawnedBy,"onUpdate:modelValue":e[5]||(e[5]=n=>o.value.spawnedBy=n),placeholder:"é€‰æ‹©å‘èµ·è€…ï¼ˆå¯é€‰ï¼‰",clearable:"",size:"small",class:"form-full",onChange:ae},{default:d(()=>[(u(!0),r(b,null,D(M.value,n=>(u(),x(f,{key:n.id,value:n.id},{default:d(()=>[a("div",ea,[a("span",{class:"agent-opt-dot",style:h({background:n.avatarColor||"#6366f1"})},null,4),c(" "+i(n.name),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),a("div",aa,[a("label",la,i(o.value.taskType==="task"?"ç›®æ ‡æˆå‘˜ï¼ˆè¢«æ´¾é£ï¼‰":"ç›®æ ‡æˆå‘˜ï¼ˆæ±‡æŠ¥å¯¹è±¡ï¼‰"),1),s(N,{modelValue:o.value.agentId,"onUpdate:modelValue":e[6]||(e[6]=n=>o.value.agentId=n),placeholder:"é€‰æ‹©ç›®æ ‡ AI æˆå‘˜",size:"small",class:"form-full",loading:E.value},{default:d(()=>[o.value.spawnedBy?(u(),r(b,{key:0},[(u(!0),r(b,null,D(z.value,n=>(u(),x(f,{key:n.agentId,value:n.agentId},{default:d(()=>[a("div",ta,[a("span",{class:"agent-opt-dot",style:h({background:J(n.agentId)})},null,4),c(" "+i(I(n.agentId))+" ",1),s(ge,{size:"small",effect:"plain",style:{"margin-left":"6px","font-size":"11px"}},{default:d(()=>[c(i(n.relation),1)]),_:2},1024)])]),_:2},1032,["value"]))),128)),z.value.length===0&&!E.value?(u(),r("div",sa," æ— å¯ç”¨ç›®æ ‡ï¼ˆæ£€æŸ¥å…³ç³»é…ç½®ï¼‰ ")):m("",!0)],64)):(u(!0),r(b,{key:1},D(M.value,n=>(u(),x(f,{key:n.id,value:n.id},{default:d(()=>[a("div",na,[a("span",{class:"agent-opt-dot",style:h({background:n.avatarColor||"#6366f1"})},null,4),c(" "+i(n.name),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","loading"])]),a("div",oa,[e[21]||(e[21]=a("label",{class:"form-label"},"æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰",-1)),s(Y,{modelValue:o.value.label,"onUpdate:modelValue":e[7]||(e[7]=n=>o.value.label=n),placeholder:"ç®€çŸ­æè¿°ï¼Œæ–¹ä¾¿è¯†åˆ«",size:"small"},null,8,["modelValue"])]),a("div",da,[a("label",ia,i(o.value.taskType==="task"?"ä»»åŠ¡æè¿°":"æ±‡æŠ¥å†…å®¹"),1),s(Y,{modelValue:o.value.task,"onUpdate:modelValue":e[8]||(e[8]=n=>o.value.task=n),type:"textarea",rows:8,placeholder:o.value.taskType==="task"?"æè¿°è¦æ´¾é£çš„å…·ä½“ä»»åŠ¡â€¦":"æè¿°è¦æ±‡æŠ¥çš„å†…å®¹â€¦",resize:"none",class:"task-textarea"},null,8,["modelValue","placeholder"])]),s(ke,{class:"adv-collapse"},{default:d(()=>[s(ye,{title:"é«˜çº§é€‰é¡¹",name:"adv"},{default:d(()=>[a("div",ua,[e[22]||(e[22]=a("label",{class:"form-label"},"æ¨¡å‹è¦†ç›–ï¼ˆå¯é€‰ï¼‰",-1)),s(Y,{modelValue:o.value.model,"onUpdate:modelValue":e[9]||(e[9]=n=>o.value.model=n),placeholder:"ç•™ç©ºä½¿ç”¨æˆå‘˜é»˜è®¤æ¨¡å‹",size:"small"},null,8,["modelValue"])])]),_:1})]),_:1})])],64)):t.value?(u(),r(b,{key:2},[a("div",ra,[a("div",va,[a("div",{class:"crumb-avatar",style:h({background:J(t.value.agentId)})},i(se(t.value.agentId)),5),a("span",ca,i(I(t.value.agentId)),1),a("span",pa,i(t.value.label||O(t.value.task,24)),1)]),a("div",ma,[s(y,{size:"small",onClick:j},{default:d(()=>[s(v,null,{default:d(()=>[s(g(F))]),_:1}),e[23]||(e[23]=c(" æ–°å»º ",-1))]),_:1}),t.value.status==="running"||t.value.status==="pending"?(u(),x(y,{key:0,size:"small",type:"danger",plain:"",loading:W.value,onClick:pe},{default:d(()=>[s(v,null,{default:d(()=>[s(g(ze))]),_:1}),e[24]||(e[24]=c(" ç»ˆæ­¢ ",-1))]),_:1},8,["loading"])):m("",!0),s(be,{title:"ç¡®è®¤åˆ é™¤è¯¥ä»»åŠ¡è®°å½•ï¼Ÿ",onConfirm:me},{reference:d(()=>[s(y,{size:"small",type:"danger",plain:""},{default:d(()=>[s(v,null,{default:d(()=>[s(g(Be))]),_:1})]),_:1})]),_:1})])]),a("div",fa,[a("div",_a,[a("span",{class:C(["ds-tag","tag-"+t.value.status])},i(ne(t.value.status)),3),a("span",ga,i(oe(t.value.taskType)),1),t.value.relation?(u(),r("span",ya,i(t.value.relation),1)):m("",!0),t.value.model?(u(),r("span",ka,i(t.value.model),1)):m("",!0)]),t.value.spawnedBy?(u(),r("div",ba,[a("span",ha,i(I(t.value.spawnedBy)),1),a("span",wa,i(t.value.taskType==="report"?"â†‘":"â†“"),1),a("span",Ta,i(I(t.value.agentId)),1)])):m("",!0),a("div",Va,[a("div",Ia,[e[25]||(e[25]=a("span",{class:"dt-key"},"åˆ›å»º",-1)),a("span",Ca,i(Q(t.value.createdAt)),1)]),t.value.startedAt?(u(),r("div",za,[e[26]||(e[26]=a("span",{class:"dt-key"},"å¼€å§‹",-1)),a("span",Ba,i(Q(t.value.startedAt)),1)])):m("",!0),t.value.endedAt?(u(),r("div",xa,[e[27]||(e[27]=a("span",{class:"dt-key"},"ç»“æŸ",-1)),a("span",Ma,i(Q(t.value.endedAt)),1)])):m("",!0),a("div",Aa,[e[28]||(e[28]=a("span",{class:"dt-key"},"è€—æ—¶",-1)),a("span",La,i(t.value.duration||"â€”"),1)])]),a("div",Ua,[e[29]||(e[29]=a("div",{class:"section-label"},"ä»»åŠ¡æè¿°",-1)),a("div",Ea,i(t.value.task),1)]),t.value.error?(u(),r("div",Sa,[e[30]||(e[30]=a("div",{class:"section-label section-error"},"é”™è¯¯ä¿¡æ¯",-1)),a("div",Na,i(t.value.error),1)])):m("",!0),t.value.output?(u(),r("div",Da,[e[31]||(e[31]=a("div",{class:"section-label"},"è¾“å‡ºæ‘˜è¦",-1)),a("div",Fa,i(O(t.value.output,300)),1)])):m("",!0)])],64)):m("",!0)]),a("div",{class:C(["ds-handle",{dragging:V.value==="chat"}]),onMousedown:e[10]||(e[10]=n=>te(n,"chat"))},[...e[32]||(e[32]=[a("div",{class:"ds-handle-bar"},null,-1)])],34),a("div",{class:"ds-chat",style:h({width:$.value+"px"})},[a("div",Ra,[s(v,null,{default:d(()=>[s(g(Z))]),_:1}),a("span",null,i(t.value?I(t.value.agentId)+" çš„ä¼šè¯":"å®æ—¶å¯¹è¯"),1),t.value?.status==="running"?(u(),r("span",Wa)):m("",!0)]),a("div",Xa,[t.value?(u(),x(xe,{key:t.value.sessionId,"agent-id":t.value.agentId,"session-id":t.value.sessionId,height:"100%"},null,8,["agent-id","session-id"])):(u(),r("div",$a,[s(v,{size:"36",color:"#c0c4cc"},{default:d(()=>[s(g(Z))]),_:1}),e[33]||(e[33]=a("p",null,[c("é€‰æ‹©ä»»åŠ¡å"),a("br"),c("åœ¨æ­¤æŸ¥çœ‹å®æ—¶å¯¹è¯")],-1))]))])],4)])}}}),Ja=Me(Ka,[["__scopeId","data-v-341371c2"]]);export{Ja as default};
