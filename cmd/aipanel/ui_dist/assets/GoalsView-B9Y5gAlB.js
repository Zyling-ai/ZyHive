import{d as qe,o as We,z as Ke,P as Qe,aa as $,c as p,e as o,b as l,w as n,f as d,l as y,y as ee,n as M,g as x,r as C,I as S,h as m,i as s,m as N,ab as Je,K as ue,F as T,p as z,t as _,ac as et,U as tt,a8 as lt,x as be,E as k,A as we}from"./index-CSEoj1Te.js";import{A as at}from"./AiChat-tgx5QDCB.js";import{_ as nt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const st={class:"goals-page"},ot={class:"goals-layout"},it={class:"goals-main"},dt={class:"page-header"},ut={style:{margin:"0"}},rt={style:{display:"flex",gap:"8px","align-items":"center"}},mt={class:"filter-bar"},ct={key:0},pt={key:1,class:"gantt-container"},ft={class:"gantt-header"},gt={class:"gantt-timeline-col"},vt={class:"gantt-months"},_t={class:"gantt-grid-lines"},yt={class:"gantt-header",style:{position:"relative",height:"0"}},ht={class:"gantt-timeline-col",style:{position:"relative"}},bt={class:"gantt-label-col"},wt={class:"gantt-label-inner"},Vt={class:"gantt-agent-avatars"},kt={key:0,class:"gantt-avatar gantt-avatar-more"},At={class:"gantt-title-text"},xt={class:"gantt-timeline-col"},Ct=["onClick","title"],Tt={key:0,class:"gantt-bar-label"},zt={key:0,class:"bar-breathe-dot"},It={style:{opacity:"0.7","font-size":"10px"}},$t={class:"gantt-status-col"},Ut={key:0,style:{color:"#c0c4cc","font-size":"12px"}},Dt={style:{display:"flex","align-items":"center",gap:"6px"}},Mt={style:{"font-size":"12px",color:"#606266"}},Yt={style:{width:"100%"}},St={style:{"text-align":"right","margin-top":"16px"}},Ht={style:{"text-align":"right","margin-bottom":"12px"}},Lt={style:{"font-family":"monospace","font-size":"12px"}},Nt={key:0,style:{"text-align":"center",padding:"20px"}},Bt={style:{display:"flex","align-items":"center",gap:"8px","margin-bottom":"6px"}},Et={style:{"font-size":"13px","font-weight":"500"}},Ft={class:"chat-panel-head"},Pt=qe({__name:"GoalsView",setup(Rt){const te=C([]),I=C([]),Z=C(""),le=C("gantt"),B=C(!1),q=C("basic"),f=C(null),W=C(!1),Q=C([]),ae=C(!1),J=C("0 9 * * 1"),ne=C(340),se=C(!1),E=C("");function Ve(a){const e=a.clientX,c=ne.value;se.value=!0;const u=v=>{ne.value=Math.max(240,Math.min(600,c-(v.clientX-e)))},b=()=>{se.value=!1,window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",b),document.body.style.cursor="",document.body.style.userSelect=""};window.addEventListener("mousemove",u),window.addEventListener("mouseup",b),document.body.style.cssText+="cursor:col-resize;user-select:none;"}function ke(){setTimeout(()=>H(),2e3)}const Ae=S(()=>I.value.map(a=>`- ${a.id}: ${a.name}${a.system?" (系统)":""}`).join(`
`)),xe=S(()=>{const a=localStorage.getItem("aipanel_token")||"TOKEN",e=`${window.location.protocol}//${window.location.host}`;return`## 目标规划助手

你是团队的目标规划助手。你可以通过调用 API 来帮用户创建和管理目标。

### 可用操作（通过 bash 工具调用）

**创建目标：**
\`\`\`bash
curl -s -X POST ${e}/api/goals \\
  -H "Authorization: Bearer ${a}" \\
  -H "Content-Type: application/json" \\
  -d '{"title":"目标名","type":"team","agentIds":["agentId"],"startAt":"2026-03-01T00:00:00Z","endAt":"2026-06-30T00:00:00Z","status":"active"}'
\`\`\`

**列出目标：**
\`\`\`bash
curl -s ${e}/api/goals -H "Authorization: Bearer ${a}"
\`\`\`

**更新进度：**
\`\`\`bash
curl -s -X PATCH ${e}/api/goals/{id}/progress \\
  -H "Authorization: Bearer ${a}" \\
  -H "Content-Type: application/json" \\
  -d '{"progress": 50}'
\`\`\`

**更新目标（标题/里程碑等）：**
\`\`\`bash
curl -s -X PATCH ${e}/api/goals/{id} \\
  -H "Authorization: Bearer ${a}" \\
  -H "Content-Type: application/json" \\
  -d '{"milestones":[{"id":"ms-1","title":"里程碑名","dueAt":"2026-04-01T00:00:00Z","done":false,"agentIds":[]}]}'
\`\`\`

**添加定期检查：**
\`\`\`bash
curl -s -X POST ${e}/api/goals/{id}/checks \\
  -H "Authorization: Bearer ${a}" \\
  -H "Content-Type: application/json" \\
  -d '{"name":"每周检查","schedule":"0 9 * * 1","agentId":"agentId","tz":"Asia/Shanghai","prompt":"请检查目标「{goal.title}」本周进展（当前{goal.progress}）","enabled":true}'
\`\`\`

### 当前团队成员
${Ae.value}

### 当前目标列表
需要时可先调用列出目标 API 查询再操作。

创建完成后告诉用户「目标已创建，页面会自动刷新」。`.trim()}),i=be({title:"",description:"",type:"team",agentIds:[],status:"draft",progress:0,startAt:"",endAt:"",milestones:[]}),g=be({name:"",agentId:"",schedule:"0 9 * * 1",tz:"Asia/Shanghai",prompt:"请检查目标「{goal.title}」的进展情况（当前进度 {goal.progress}），距截止日期 {goal.endAt} 还有一段时间，请总结近期进展并建议下一步行动。",enabled:!0}),F=S(()=>{const a={};for(const e of I.value)a[e.id]=e.name;return a}),P=S(()=>{const a={};for(const e of I.value)a[e.id]=e.avatarColor||"#409eff";return a}),K=S(()=>Z.value?te.value.filter(a=>a.agentIds.includes(Z.value)):te.value),R=S(()=>{const a=K.value.filter(h=>Y(h.startAt)&&Y(h.endAt));if(!a.length){const h=new Date;return{start:new Date(h.getFullYear(),h.getMonth(),1),end:new Date(h.getFullYear(),h.getMonth()+3,1)}}const e=a.map(h=>new Date(h.startAt).getTime()),c=a.map(h=>new Date(h.endAt).getTime()),u=Math.min(...e),b=Math.max(...c),U=(b-u)*.05;return{start:new Date(u-U),end:new Date(b+U)}}),re=S(()=>Ee(R.value.start,R.value.end)),me=S(()=>{const{start:a,end:e}=R.value,c=Date.now();if(c<a.getTime()||c>e.getTime())return null;const u=e.getTime()-a.getTime();return`${(c-a.getTime())/u*100}%`});We(async()=>{const[a]=await Promise.all([Ke.list().catch(()=>({data:[]}))]);I.value=a.data||[];const e=I.value.filter(c=>!c.system);E.value=e[0]?.id||I.value[0]?.id||"",await H()}),Qe(q,async a=>{a==="records"&&f.value&&await Ce(f.value.id)});async function H(){try{const a=await $.list(Z.value||void 0);te.value=a.data||[]}catch{}}async function Ce(a){ae.value=!0;try{const e=await $.listCheckRecords(a);Q.value=(e.data||[]).slice().reverse()}catch{Q.value=[]}finally{ae.value=!1}}function Te(){f.value=null,q.value="basic",Object.assign(i,{title:"",description:"",type:"team",agentIds:[],status:"draft",progress:0,startAt:"",endAt:"",milestones:[]}),B.value=!0}function ce(a){f.value=a,q.value="basic",Object.assign(i,{title:a.title,description:a.description||"",type:a.type,agentIds:[...a.agentIds||[]],status:a.status,progress:a.progress,startAt:Y(a.startAt)?a.startAt:"",endAt:Y(a.endAt)?a.endAt:"",milestones:(a.milestones||[]).map(e=>({...e}))}),B.value=!0}async function ze(){if(!i.title.trim()){k.warning("请填写目标标题");return}const a={title:i.title,description:i.description||void 0,type:i.type,agentIds:i.agentIds,status:i.status,progress:i.progress,startAt:i.startAt||void 0,endAt:i.endAt||void 0,milestones:i.milestones.map(e=>({...e,id:e.id||"ms-"+Math.random().toString(36).slice(2,10)}))};try{f.value?(await $.update(f.value.id,a),k.success("保存成功")):(await $.create(a),k.success("创建成功")),B.value=!1,await H()}catch(e){k.error(e.response?.data?.error||"操作失败")}}async function Ie(a){try{await we.confirm(`确定删除目标「${a.title}」？`,"删除确认",{type:"warning"}),await $.delete(a.id),k.success("已删除"),await H()}catch(e){e!=="cancel"&&k.error("删除失败")}}function $e(){i.milestones.push({id:"ms-"+Math.random().toString(36).slice(2,10),title:"",dueAt:"",done:!1,agentIds:[]})}function Ue(){Object.assign(g,{name:"",agentId:I.value[0]?.id||"",schedule:"0 9 * * 1",tz:"Asia/Shanghai",prompt:"请检查目标「{goal.title}」的进展情况（当前进度 {goal.progress}），距截止日期 {goal.endAt} 还有一段时间，请总结近期进展并建议下一步行动。",enabled:!0}),J.value="0 9 * * 1",W.value=!0}function De(a){a!=="custom"&&(g.schedule=a)}async function Me(){if(!g.name.trim()){k.warning("请填写检查名称");return}if(!g.agentId){k.warning("请选择执行成员");return}if(!g.schedule.trim()){k.warning("请设置检查频率");return}if(f.value)try{await $.addCheck(f.value.id,{name:g.name,agentId:g.agentId,schedule:g.schedule,tz:g.tz,prompt:g.prompt,enabled:g.enabled}),k.success("添加成功"),W.value=!1;const a=await $.get(f.value.id);f.value=a.data,await H()}catch(a){k.error(a.response?.data?.error||"添加失败")}}async function Ye(a){if(f.value)try{await $.updateCheck(f.value.id,a.id,{enabled:a.enabled})}catch{k.error("更新失败")}}async function Se(a){if(f.value)try{await $.runCheck(f.value.id,a.id),k.success("已触发检查")}catch(e){k.error(e.response?.data?.error||"触发失败")}}async function He(a){if(f.value)try{await we.confirm(`确定删除检查计划「${a.name}」？`,"删除确认",{type:"warning"}),await $.removeCheck(f.value.id,a.id),k.success("已删除");const e=await $.get(f.value.id);f.value=e.data,await H()}catch(e){e!=="cancel"&&k.error("删除失败")}}function Y(a){if(!a)return!1;const e=new Date(a);return!isNaN(e.getTime())&&e.getFullYear()>1970}function pe(a){return Y(a.startAt)&&Y(a.endAt)}function Le(a){const{start:e,end:c}=R.value,u=c.getTime()-e.getTime(),b=new Date(a.startAt).getTime(),v=new Date(a.endAt).getTime();return Math.max(1,(v-b)/u*100)}function Ne(a){const{start:e,end:c}=R.value,u=c.getTime()-e.getTime(),b=new Date(a.startAt).getTime(),v=new Date(a.endAt).getTime(),U=Math.max(0,(b-e.getTime())/u*100),h=Math.max(1,(v-b)/u*100);let L="#409eff";const D=a.agentIds?.[0];D&&P.value[D]&&(L=P.value[D]);let j=L;if(a.type==="team"&&a.agentIds?.length>1){const w=a.agentIds[1],oe=w&&P.value[w]?P.value[w]:"#67c23a";j=`linear-gradient(90deg, ${L}, ${oe})`}return{left:`${U}%`,width:`${h}%`,background:j}}function Be(a){const{start:e,end:c}=R.value;if(!Y(a.dueAt))return"-100%";const u=c.getTime()-e.getTime();return`${(new Date(a.dueAt).getTime()-e.getTime())/u*100}%`}function Ee(a,e){const c=[],u=new Date(a.getFullYear(),a.getMonth(),1),b=e.getTime()-a.getTime();for(;u<=e;){const v=(u.getTime()-a.getTime())/b*100;v>=0&&v<=100&&c.push({label:`${u.getFullYear()}/${u.getMonth()+1}`,left:`${v}%`}),u.setMonth(u.getMonth()+1)}return c}function fe(a){return{draft:"草稿",active:"进行中",completed:"已完成",cancelled:"已取消"}[a]||a}function ge(a){return{draft:"info",active:"",completed:"success",cancelled:"danger"}[a]||"info"}function ve(a){return Y(a)?new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"—"}function Fe(a){if(!a)return"";const e=new Date(a);return isNaN(e.getTime())?"":e.toLocaleString("zh-CN")}return(a,e)=>{const c=m("el-icon"),u=m("el-radio-button"),b=m("el-radio-group"),v=m("el-button"),U=m("el-text"),h=m("el-empty"),L=m("el-tooltip"),D=m("el-tag"),j=m("el-card"),w=m("el-table-column"),oe=m("el-progress"),_e=m("el-table"),G=m("el-input"),V=m("el-form-item"),A=m("el-option"),X=m("el-select"),ie=m("el-date-picker"),Pe=m("el-slider"),Re=m("el-checkbox"),ye=m("el-form"),de=m("el-tab-pane"),he=m("el-switch"),je=m("el-timeline-item"),Ge=m("el-timeline"),Xe=m("el-tabs"),Oe=m("el-drawer"),Ze=m("el-dialog");return s(),p("div",st,[o("div",ot,[o("div",it,[o("div",dt,[o("h2",ut,[l(c,{style:{"vertical-align":"-2px","margin-right":"6px"}},{default:n(()=>[l(N(Je))]),_:1}),e[23]||(e[23]=d("目标规划 ",-1))]),o("div",rt,[l(b,{modelValue:le.value,"onUpdate:modelValue":e[0]||(e[0]=t=>le.value=t),size:"small"},{default:n(()=>[l(u,{value:"gantt"},{default:n(()=>[...e[24]||(e[24]=[d("甘特图",-1)])]),_:1}),l(u,{value:"list"},{default:n(()=>[...e[25]||(e[25]=[d("列表",-1)])]),_:1})]),_:1},8,["modelValue"]),l(v,{type:"primary",onClick:Te},{default:n(()=>[l(c,null,{default:n(()=>[l(N(ue))]),_:1}),e[26]||(e[26]=d(" 新建目标 ",-1))]),_:1})])]),o("div",mt,[l(U,{type:"info",size:"small",style:{"margin-right":"4px"}},{default:n(()=>[...e[27]||(e[27]=[d("筛选成员：",-1)])]),_:1}),l(b,{modelValue:Z.value,"onUpdate:modelValue":e[1]||(e[1]=t=>Z.value=t),size:"small",onChange:H},{default:n(()=>[l(u,{value:""},{default:n(()=>[...e[28]||(e[28]=[d("全部",-1)])]),_:1}),(s(!0),p(T,null,z(I.value,t=>(s(),y(u,{key:t.id,value:t.id},{default:n(()=>[d(_(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),le.value==="gantt"?(s(),y(j,{key:0,shadow:"hover",class:"gantt-card"},{default:n(()=>[K.value.length===0?(s(),p("div",ct,[l(h,{description:"暂无目标，点击「新建目标」开始规划"})])):(s(),p("div",pt,[o("div",ft,[e[29]||(e[29]=o("div",{class:"gantt-label-col"},null,-1)),o("div",gt,[o("div",vt,[(s(!0),p(T,null,z(re.value,t=>(s(),p("div",{key:t.label,class:"gantt-month-label",style:M({left:t.left})},_(t.label),5))),128))]),o("div",_t,[(s(!0),p(T,null,z(re.value,t=>(s(),p("div",{key:"line-"+t.label,class:"gantt-grid-line",style:M({left:t.left})},null,4))),128))])])]),o("div",yt,[e[30]||(e[30]=o("div",{class:"gantt-label-col"},null,-1)),o("div",ht,[me.value!==null?(s(),p("div",{key:0,class:"gantt-today-line",style:M({left:me.value})},null,4)):x("",!0)])]),(s(!0),p(T,null,z(K.value,t=>(s(),p("div",{key:t.id,class:"gantt-row"},[o("div",bt,[o("div",wt,[o("div",Vt,[(s(!0),p(T,null,z(t.agentIds.slice(0,3),r=>(s(),y(L,{key:r,content:F.value[r]||r,placement:"top"},{default:n(()=>[o("div",{class:"gantt-avatar",style:M({background:P.value[r]||"#409eff"})},_((F.value[r]||r).slice(0,1)),5)]),_:2},1032,["content"]))),128)),t.agentIds.length>3?(s(),p("div",kt," +"+_(t.agentIds.length-3),1)):x("",!0)]),l(L,{content:t.title,placement:"top","show-after":300},{default:n(()=>[o("span",At,_(t.title),1)]),_:2},1032,["content"])])]),o("div",xt,[pe(t)?(s(),p("div",{key:0,class:"gantt-bar",style:M(Ne(t)),onClick:r=>ce(t),title:t.title},[o("div",{class:"gantt-bar-progress",style:M({width:t.progress+"%"})},null,4),Le(t)>8?(s(),p("span",Tt,[t.status==="active"?(s(),p("span",zt)):x("",!0),d(" "+_(t.title)+" ",1),o("span",It,_(t.progress)+"%",1)])):x("",!0)],12,Ct)):x("",!0),pe(t)?(s(!0),p(T,{key:1},z(t.milestones,r=>(s(),y(L,{key:r.id,content:`${r.title}${r.done?" ✓":""}`,placement:"top"},{default:n(()=>[o("div",{class:ee(["gantt-milestone",{"gantt-milestone-done":r.done}]),style:M({left:Be(r)})},null,6)]),_:2},1032,["content"]))),128)):x("",!0)]),o("div",$t,[l(D,{type:ge(t.status),size:"small",class:ee({"status-active":t.status==="active"})},{default:n(()=>[d(_(fe(t.status)),1)]),_:2},1032,["type","class"])])]))),128))]))]),_:1})):(s(),y(j,{key:1,shadow:"hover"},{default:n(()=>[l(_e,{data:K.value,stripe:""},{default:n(()=>[l(w,{prop:"title",label:"目标","min-width":"160"}),l(w,{label:"类型",width:"80"},{default:n(({row:t})=>[l(D,{size:"small",type:t.type==="team"?"warning":"info"},{default:n(()=>[d(_(t.type==="team"?"团队":"个人"),1)]),_:2},1032,["type"])]),_:1}),l(w,{label:"参与成员","min-width":"140"},{default:n(({row:t})=>[(s(!0),p(T,null,z(t.agentIds,r=>(s(),y(D,{key:r,size:"small",style:{margin:"1px"}},{default:n(()=>[d(_(F.value[r]||r),1)]),_:2},1024))),128)),t.agentIds.length?x("",!0):(s(),p("span",Ut,"—"))]),_:1}),l(w,{label:"状态",width:"90"},{default:n(({row:t})=>[l(D,{type:ge(t.status),size:"small",class:ee({"status-active":t.status==="active"})},{default:n(()=>[d(_(fe(t.status)),1)]),_:2},1032,["type","class"])]),_:1}),l(w,{label:"进度",width:"120"},{default:n(({row:t})=>[o("div",Dt,[l(oe,{percentage:t.progress,"stroke-width":6,style:{flex:"1","min-width":"60px"}},null,8,["percentage"])])]),_:1}),l(w,{label:"时间范围","min-width":"180"},{default:n(({row:t})=>[o("span",Mt,_(ve(t.startAt))+" ~ "+_(ve(t.endAt)),1)]),_:1}),l(w,{label:"操作",width:"120"},{default:n(({row:t})=>[l(v,{size:"small",onClick:r=>ce(t)},{default:n(()=>[...e[31]||(e[31]=[d("编辑",-1)])]),_:1},8,["onClick"]),l(v,{size:"small",type:"danger",onClick:r=>Ie(t)},{default:n(()=>[...e[32]||(e[32]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),K.value.length===0?(s(),y(h,{key:0,description:"暂无目标"})):x("",!0)]),_:1})),l(Oe,{modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=t=>B.value=t),title:f.value?"编辑目标":"新建目标",size:"580px","destroy-on-close":""},{default:n(()=>[l(Xe,{modelValue:q.value,"onUpdate:modelValue":e[11]||(e[11]=t=>q.value=t)},{default:n(()=>[l(de,{label:"基本信息",name:"basic"},{default:n(()=>[l(ye,{model:i,"label-width":"100px"},{default:n(()=>[l(V,{label:"标题",required:""},{default:n(()=>[l(G,{modelValue:i.title,"onUpdate:modelValue":e[2]||(e[2]=t=>i.title=t),placeholder:"目标标题"},null,8,["modelValue"])]),_:1}),l(V,{label:"描述"},{default:n(()=>[l(G,{modelValue:i.description,"onUpdate:modelValue":e[3]||(e[3]=t=>i.description=t),type:"textarea",rows:2,placeholder:"（可选）"},null,8,["modelValue"])]),_:1}),l(V,{label:"类型"},{default:n(()=>[l(b,{modelValue:i.type,"onUpdate:modelValue":e[4]||(e[4]=t=>i.type=t)},{default:n(()=>[l(u,{value:"personal"},{default:n(()=>[...e[33]||(e[33]=[d("个人",-1)])]),_:1}),l(u,{value:"team"},{default:n(()=>[...e[34]||(e[34]=[d("团队",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"参与成员"},{default:n(()=>[l(X,{modelValue:i.agentIds,"onUpdate:modelValue":e[5]||(e[5]=t=>i.agentIds=t),multiple:"",placeholder:"选择成员",style:{width:"100%"}},{default:n(()=>[(s(!0),p(T,null,z(I.value,t=>(s(),y(A,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"状态"},{default:n(()=>[l(X,{modelValue:i.status,"onUpdate:modelValue":e[6]||(e[6]=t=>i.status=t),style:{width:"100%"}},{default:n(()=>[l(A,{label:"草稿",value:"draft"}),l(A,{label:"进行中",value:"active"}),l(A,{label:"已完成",value:"completed"}),l(A,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"开始时间"},{default:n(()=>[l(ie,{modelValue:i.startAt,"onUpdate:modelValue":e[7]||(e[7]=t=>i.startAt=t),type:"datetime",placeholder:"选择开始时间",style:{width:"100%"},"value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue"])]),_:1}),l(V,{label:"结束时间"},{default:n(()=>[l(ie,{modelValue:i.endAt,"onUpdate:modelValue":e[8]||(e[8]=t=>i.endAt=t),type:"datetime",placeholder:"选择结束时间",style:{width:"100%"},"value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue"])]),_:1}),f.value?(s(),y(V,{key:0,label:"进度"},{default:n(()=>[l(Pe,{modelValue:i.progress,"onUpdate:modelValue":e[9]||(e[9]=t=>i.progress=t),min:0,max:100,"show-input":""},null,8,["modelValue"])]),_:1})):x("",!0),l(V,{label:"里程碑"},{default:n(()=>[o("div",Yt,[(s(!0),p(T,null,z(i.milestones,(t,r)=>(s(),p("div",{key:r,class:"milestone-row"},[l(Re,{modelValue:t.done,"onUpdate:modelValue":O=>t.done=O},null,8,["modelValue","onUpdate:modelValue"]),l(G,{modelValue:t.title,"onUpdate:modelValue":O=>t.title=O,placeholder:"里程碑标题",size:"small",style:{flex:"1"}},null,8,["modelValue","onUpdate:modelValue"]),l(ie,{modelValue:t.dueAt,"onUpdate:modelValue":O=>t.dueAt=O,type:"date",placeholder:"截止日",size:"small",style:{width:"130px"},"value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue","onUpdate:modelValue"]),l(v,{type:"danger",size:"small",circle:"",onClick:O=>i.milestones.splice(r,1)},{default:n(()=>[l(c,null,{default:n(()=>[l(N(et))]),_:1})]),_:1},8,["onClick"])]))),128)),l(v,{size:"small",onClick:$e,style:{"margin-top":"4px"}},{default:n(()=>[l(c,null,{default:n(()=>[l(N(ue))]),_:1}),e[35]||(e[35]=d(" 添加里程碑 ",-1))]),_:1})])]),_:1})]),_:1},8,["model"]),o("div",St,[l(v,{onClick:e[10]||(e[10]=t=>B.value=!1)},{default:n(()=>[...e[36]||(e[36]=[d("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:ze},{default:n(()=>[d(_(f.value?"保存":"创建"),1)]),_:1})])]),_:1}),f.value?(s(),y(de,{key:0,label:"定期检查",name:"checks"},{default:n(()=>[o("div",Ht,[l(v,{type:"primary",size:"small",onClick:Ue},{default:n(()=>[l(c,null,{default:n(()=>[l(N(ue))]),_:1}),e[37]||(e[37]=d(" 添加检查 ",-1))]),_:1})]),l(_e,{data:f.value.checks,size:"small",stripe:""},{default:n(()=>[l(w,{prop:"name",label:"名称","min-width":"120"}),l(w,{label:"频率","min-width":"140"},{default:n(({row:t})=>[o("span",Lt,_(t.schedule),1),l(U,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:n(()=>[d("("+_(t.tz||"Asia/Shanghai")+")",1)]),_:2},1024)]),_:1}),l(w,{label:"执行成员",width:"100"},{default:n(({row:t})=>[o("span",null,_(F.value[t.agentId]||t.agentId),1)]),_:1}),l(w,{label:"启用",width:"70"},{default:n(({row:t})=>[l(he,{modelValue:t.enabled,"onUpdate:modelValue":r=>t.enabled=r,size:"small",onChange:r=>Ye(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(w,{label:"操作",width:"140"},{default:n(({row:t})=>[l(v,{size:"small",onClick:r=>Se(t)},{default:n(()=>[...e[38]||(e[38]=[d("立即运行",-1)])]),_:1},8,["onClick"]),l(v,{size:"small",type:"danger",onClick:r=>He(t)},{default:n(()=>[...e[39]||(e[39]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),f.value.checks.length?x("",!0):(s(),y(h,{key:0,description:"暂无检查计划"}))]),_:1})):x("",!0),f.value?(s(),y(de,{key:1,label:"检查记录",name:"records"},{default:n(()=>[ae.value?(s(),p("div",Nt,[l(c,{class:"is-loading"},{default:n(()=>[l(N(tt))]),_:1})])):Q.value.length?(s(),y(Ge,{key:1},{default:n(()=>[(s(!0),p(T,null,z(Q.value,t=>(s(),y(je,{key:t.id,timestamp:Fe(t.runAt),type:t.status==="ok"?"success":"danger",placement:"top"},{default:n(()=>[l(j,{shadow:"never",style:{padding:"0"}},{default:n(()=>[o("div",Bt,[o("div",{class:"gantt-avatar",style:M({background:P.value[t.agentId]||"#409eff"})},_((F.value[t.agentId]||t.agentId||"?").slice(0,1)),5),o("span",Et,_(F.value[t.agentId]||t.agentId),1),l(D,{type:t.status==="ok"?"success":"danger",size:"small"},{default:n(()=>[d(_(t.status),1)]),_:2},1032,["type"])]),l(U,{style:{"font-size":"12px","white-space":"pre-wrap"}},{default:n(()=>[d(_(t.output||"（无输出）"),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(s(),y(h,{key:2,description:"暂无检查记录"}))]),_:1})):x("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"]),l(Ze,{modelValue:W.value,"onUpdate:modelValue":e[21]||(e[21]=t=>W.value=t),title:"添加定期检查",width:"500px"},{footer:n(()=>[l(v,{onClick:e[20]||(e[20]=t=>W.value=!1)},{default:n(()=>[...e[41]||(e[41]=[d("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:Me},{default:n(()=>[...e[42]||(e[42]=[d("添加",-1)])]),_:1})]),default:n(()=>[l(ye,{model:g,"label-width":"100px"},{default:n(()=>[l(V,{label:"名称",required:""},{default:n(()=>[l(G,{modelValue:g.name,"onUpdate:modelValue":e[13]||(e[13]=t=>g.name=t),placeholder:"如：每周进度检查"},null,8,["modelValue"])]),_:1}),l(V,{label:"执行成员",required:""},{default:n(()=>[l(X,{modelValue:g.agentId,"onUpdate:modelValue":e[14]||(e[14]=t=>g.agentId=t),style:{width:"100%"}},{default:n(()=>[(s(!0),p(T,null,z(I.value,t=>(s(),y(A,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"检查频率"},{default:n(()=>[l(X,{modelValue:J.value,"onUpdate:modelValue":e[15]||(e[15]=t=>J.value=t),style:{width:"100%"},onChange:De},{default:n(()=>[l(A,{label:"每天上午9点",value:"0 9 * * *"}),l(A,{label:"每周一上午9点",value:"0 9 * * 1"}),l(A,{label:"每周五下午5点",value:"0 17 * * 5"}),l(A,{label:"每月1日上午9点",value:"0 9 1 * *"}),l(A,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),J.value==="custom"?(s(),y(V,{key:0,label:"Cron 表达式"},{default:n(()=>[l(G,{modelValue:g.schedule,"onUpdate:modelValue":e[16]||(e[16]=t=>g.schedule=t),placeholder:"0 9 * * 1"},null,8,["modelValue"])]),_:1})):x("",!0),l(V,{label:"时区"},{default:n(()=>[l(X,{modelValue:g.tz,"onUpdate:modelValue":e[17]||(e[17]=t=>g.tz=t),style:{width:"100%"}},{default:n(()=>[l(A,{label:"Asia/Shanghai",value:"Asia/Shanghai"}),l(A,{label:"UTC",value:"UTC"}),l(A,{label:"America/New_York",value:"America/New_York"})]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"检查提示词"},{default:n(()=>[l(G,{modelValue:g.prompt,"onUpdate:modelValue":e[18]||(e[18]=t=>g.prompt=t),type:"textarea",rows:4,placeholder:"可用变量：{goal.title} {goal.progress} {goal.endAt}"},null,8,["modelValue"]),l(U,{type:"info",size:"small",style:{display:"block","margin-top":"4px"}},{default:n(()=>[...e[40]||(e[40]=[d(" 可用变量：{goal.title} {goal.progress} {goal.endAt} {goal.startAt} {goal.status} ",-1)])]),_:1})]),_:1}),l(V,{label:"启用"},{default:n(()=>[l(he,{modelValue:g.enabled,"onUpdate:modelValue":e[19]||(e[19]=t=>g.enabled=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),o("div",{class:ee(["ss-handle",{dragging:se.value}]),onMousedown:Ve},[...e[43]||(e[43]=[o("div",{class:"ss-handle-bar"},null,-1)])],34),o("div",{class:"goals-chat",style:M({width:ne.value+"px"})},[o("div",Ft,[l(c,null,{default:n(()=>[l(N(lt))]),_:1}),e[44]||(e[44]=d(" AI 目标助手 ",-1)),l(X,{modelValue:E.value,"onUpdate:modelValue":e[22]||(e[22]=t=>E.value=t),size:"small",style:{"margin-left":"auto",width:"120px"},placeholder:"选择成员"},{default:n(()=>[(s(!0),p(T,null,z(I.value,t=>(s(),y(A,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),E.value?(s(),y(at,{key:E.value,"agent-id":E.value,context:xe.value,"welcome-message":"你好！我可以帮你创建和管理目标。比如：「帮我创建一个Q2增长目标，让引引负责，3月到6月，每周检查一次」",examples:["帮我创建一个团队目标：Q2用户增长，3月1日到6月30日","给「产品发布」目标添加3个里程碑","查看当前所有进行中的目标","帮我设置每周一检查「增长目标」的进度"],style:{flex:"1","min-height":"0"},onResponse:ke},null,8,["agent-id","context"])):x("",!0)],4)])])}}}),Ot=nt(Pt,[["__scopeId","data-v-102415d5"]]);export{Ot as default};
