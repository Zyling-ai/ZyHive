import{d as et,o as tt,z as lt,P as at,aa as M,c as i,e as n,b as l,w as s,g as D,F as h,p as A,n as T,y as ee,f as g,t as _,l as x,r as k,I as S,h as f,i as d,m as w,a1 as st,K as X,ab as te,ac as xe,ad as ue,U as nt,a8 as ot,x as Te,E as C,A as dt}from"./index-B_oCvtw7.js";import{A as it}from"./AiChat-O9kFRMnM.js";import{_ as ut}from"./_plugin-vue_export-helper-DlAUqK2U.js";const rt={class:"goals-studio"},mt={class:"sidebar-top"},ct={class:"sidebar-acts"},pt={class:"gs-filter"},vt={class:"goal-list"},ft={key:0,class:"list-empty"},gt=["onClick"],_t={class:"gi-top"},yt={class:"gi-title"},bt={class:"gi-progress-wrap"},ht={class:"gi-progress-num"},Vt={class:"gi-bottom"},wt={class:"gi-avatars"},kt={key:0,class:"gi-avatar-more"},At={class:"gi-dates"},Ct={class:"gs-editor"},zt={key:0,class:"editor-gantt-overview"},xt={class:"overview-header"},Tt={class:"overview-title"},Ut={key:0,class:"gantt-empty"},It={key:1,class:"gantt-container"},Mt={class:"gantt-header"},Dt={class:"gantt-timeline-col"},$t={class:"gantt-months"},Yt={class:"gantt-grid-lines"},Ht={style:{position:"relative",height:"0",display:"flex"}},St={class:"gantt-timeline-col",style:{position:"relative"}},Nt=["onClick"],Lt={class:"gantt-label-col"},Bt={class:"gantt-label-inner"},Et={class:"gantt-agent-avatars"},Ft={class:"gantt-goal-name"},Gt={class:"gantt-timeline-col"},Rt={key:0,class:"gantt-bar-label"},Zt=["title"],jt={key:1,class:"gantt-no-date"},Pt={class:"editor-toolbar"},Ot={class:"editor-breadcrumb"},Xt={class:"toolbar-acts"},qt={class:"editor-form"},Wt={style:{width:"100%"}},Kt={class:"editor-toolbar"},Qt={class:"editor-breadcrumb"},Jt={class:"crumb-name"},el={class:"toolbar-acts"},tl={class:"editor-form"},ll={style:{width:"100%"}},al={class:"tab-panel"},sl={class:"tab-panel-head"},nl={class:"code-cell"},ol={class:"tab-panel"},dl={key:0,style:{"text-align":"center",padding:"20px"}},il={class:"record-card"},ul={class:"record-header"},rl={class:"rec-name"},ml={class:"rec-output"},cl={class:"chat-panel-head"},pl={class:"chat-wrap"},vl=et({__name:"GoalsView",setup(fl){const le=k(260),ae=k(360),G=k("");let re=0,se=0;function me(a,e){G.value=e,re=a.clientX,se=e==="side"?le.value:ae.value,document.addEventListener("mousemove",ce),document.addEventListener("mouseup",pe),a.preventDefault()}function ce(a){const e=a.clientX-re;G.value==="side"?le.value=Math.max(200,Math.min(400,se+e)):ae.value=Math.max(280,Math.min(560,se-e))}function pe(){G.value="",document.removeEventListener("mousemove",ce),document.removeEventListener("mouseup",pe)}const ne=k([]),U=k([]),q=k(""),W=k(""),m=k(null),N=k(!1),K=k(!1),R=k("basic"),Z=k(!1),Q=k([]),oe=k(!1),J=k("0 9 * * 1"),L=k(""),o=Te({title:"",description:"",type:"team",agentIds:[],status:"draft",progress:0,startAt:"",endAt:"",milestones:[]}),b=Te({name:"",agentId:"",schedule:"0 9 * * 1",tz:"Asia/Shanghai",prompt:"请检查目标「{goal.title}」的进展情况（当前进度 {goal.progress}），距截止日期 {goal.endAt} 还有一段时间，请总结近期进展并建议下一步行动。",enabled:!0}),j=S(()=>{const a={};return U.value.forEach(e=>{a[e.id]=e.name}),a}),Y=S(()=>{const a={};return U.value.forEach(e=>{a[e.id]=e.avatarColor||"#409eff"}),a}),P=S(()=>{let a=[...ne.value];return q.value&&(a=a.filter(e=>e.status===q.value)),W.value&&(a=a.filter(e=>(e.agentIds||[]).includes(W.value))),a}),B=S(()=>{const a=P.value.filter(V=>$(V.startAt)&&$(V.endAt));if(!a.length){const V=new Date;return{start:new Date(V.getFullYear(),V.getMonth(),1),end:new Date(V.getFullYear(),V.getMonth()+3,1)}}const e=a.map(V=>new Date(V.startAt).getTime()),u=a.map(V=>new Date(V.endAt).getTime()),r=Math.min(...e),c=Math.max(...u),y=(c-r)*.05;return{start:new Date(r-y),end:new Date(c+y)}}),ve=S(()=>Re(B.value.start,B.value.end)),fe=S(()=>{const{start:a,end:e}=B.value,u=Date.now();return u<a.getTime()||u>e.getTime()?null:`${(u-a.getTime())/(e.getTime()-a.getTime())*100}%`}),Ue=S(()=>{const a=localStorage.getItem("aipanel_token")||"TOKEN",e=`${window.location.protocol}//${window.location.host}`,u=U.value.map(r=>`- ${r.id}: ${r.name}${r.system?" (系统)":""}`).join(`
`);return`## 目标规划助手

你是团队的目标规划助手，可通过 API 帮用户创建和管理目标。

**创建目标：**
\`\`\`bash
curl -s -X POST ${e}/api/goals -H "Authorization: Bearer ${a}" -H "Content-Type: application/json" -d '{"title":"目标名","type":"team","agentIds":["agentId"],"startAt":"2026-03-01T00:00:00Z","endAt":"2026-06-30T00:00:00Z","status":"active"}'
\`\`\`

**列出目标：**
\`\`\`bash
curl -s ${e}/api/goals -H "Authorization: Bearer ${a}"
\`\`\`

**更新进度：**
\`\`\`bash
curl -s -X PATCH ${e}/api/goals/{id}/progress -H "Authorization: Bearer ${a}" -H "Content-Type: application/json" -d '{"progress":50}'
\`\`\`

**添加定期检查：**
\`\`\`bash
curl -s -X POST ${e}/api/goals/{id}/checks -H "Authorization: Bearer ${a}" -H "Content-Type: application/json" -d '{"name":"每周检查","schedule":"0 9 * * 1","agentId":"agentId","tz":"Asia/Shanghai","prompt":"请检查目标「{goal.title}」本周进展","enabled":true}'
\`\`\`

### 当前团队成员
${u}

创建完成后告诉用户「目标已创建，页面会自动刷新」。`.trim()});tt(async()=>{const a=await lt.list().catch(()=>({data:[]}));U.value=(a.data||[]).filter(e=>!e.system),L.value=U.value[0]?.id||"",await H()}),at(R,async a=>{a==="records"&&m.value&&await Ie(m.value.id)});async function H(){try{const a=await M.list();if(ne.value=a.data||[],m.value){const e=ne.value.find(u=>u.id===m.value.id);e&&(m.value=e)}}catch{}}async function Ie(a){oe.value=!0;try{const e=await M.listCheckRecords(a);Q.value=(e.data||[]).slice().reverse()}catch{Q.value=[]}finally{oe.value=!1}}function ge(a){m.value=a,N.value=!1,R.value="basic",Object.assign(o,{title:a.title,description:a.description||"",type:a.type,agentIds:[...a.agentIds||[]],status:a.status,progress:a.progress,startAt:$(a.startAt)?a.startAt:"",endAt:$(a.endAt)?a.endAt:"",milestones:(a.milestones||[]).map(e=>({...e}))})}function _e(){m.value=null,N.value=!0,R.value="basic",Object.assign(o,{title:"",description:"",type:"team",agentIds:[],status:"draft",progress:0,startAt:"",endAt:"",milestones:[]})}async function ye(){if(!o.title.trim()){C.warning("请填写目标标题");return}K.value=!0;const a={title:o.title,description:o.description||void 0,type:o.type,agentIds:o.agentIds,status:o.status,progress:o.progress,startAt:o.startAt||void 0,endAt:o.endAt||void 0,milestones:o.milestones.map(e=>({...e,id:e.id||"ms-"+Math.random().toString(36).slice(2,10)}))};try{m.value?(await M.update(m.value.id,a),C.success("保存成功")):(await M.create(a),C.success("创建成功"),N.value=!1),await H()}catch(e){C.error(e.response?.data?.error||"操作失败")}finally{K.value=!1}}async function Me(){if(m.value)try{await M.delete(m.value.id),C.success("已删除"),m.value=null,await H()}catch{C.error("删除失败")}}function be(){o.milestones.push({id:"ms-"+Math.random().toString(36).slice(2,10),title:"",dueAt:"",done:!1,agentIds:[]})}function De(){Object.assign(b,{name:"",agentId:U.value[0]?.id||"",schedule:"0 9 * * 1",tz:"Asia/Shanghai",prompt:"请检查目标「{goal.title}」的进展情况（当前进度 {goal.progress}），距截止日期 {goal.endAt} 还有一段时间，请总结近期进展并建议下一步行动。",enabled:!0}),J.value="0 9 * * 1",Z.value=!0}function $e(a){a!=="custom"&&(b.schedule=a)}async function Ye(){if(!b.name.trim()){C.warning("请填写检查名称");return}if(!b.agentId){C.warning("请选择执行成员");return}if(m.value)try{await M.addCheck(m.value.id,{...b}),C.success("添加成功"),Z.value=!1;const a=await M.get(m.value.id);m.value=a.data,await H()}catch(a){C.error(a.response?.data?.error||"添加失败")}}async function He(a){if(m.value)try{await M.updateCheck(m.value.id,a.id,{enabled:a.enabled})}catch{C.error("更新失败")}}async function Se(a){if(m.value)try{await M.runCheck(m.value.id,a.id),C.success("已触发检查")}catch(e){C.error(e.response?.data?.error||"触发失败")}}async function Ne(a){if(m.value)try{await dt.confirm(`确定删除检查计划「${a.name}」？`,"删除确认",{type:"warning"}),await M.removeCheck(m.value.id,a.id),C.success("已删除");const e=await M.get(m.value.id);m.value=e.data,await H()}catch(e){e!=="cancel"&&C.error("删除失败")}}function Le(){setTimeout(()=>H(),2e3)}function $(a){if(!a)return!1;const e=new Date(a);return!isNaN(e.getTime())&&e.getFullYear()>1970}function Be(a){return $(a.startAt)&&$(a.endAt)}function Ee(a){const{start:e,end:u}=B.value,r=u.getTime()-e.getTime();return Math.max(1,(new Date(a.endAt).getTime()-new Date(a.startAt).getTime())/r*100)}function Fe(a){const{start:e,end:u}=B.value,r=u.getTime()-e.getTime(),c=new Date(a.startAt).getTime(),y=new Date(a.endAt).getTime(),V=Math.max(0,(c-e.getTime())/r*100),I=Math.max(1,(y-c)/r*100),p=a.agentIds?.[0]&&Y.value[a.agentIds[0]]?Y.value[a.agentIds[0]]:"#409eff",E=a.agentIds?.[1]&&Y.value[a.agentIds[1]]?Y.value[a.agentIds[1]]:p;return{left:`${V}%`,width:`${I}%`,background:a.agentIds?.length>1?`linear-gradient(90deg,${p},${E})`:p}}function Ge(a){const{start:e,end:u}=B.value;return $(a.dueAt)?`${(new Date(a.dueAt).getTime()-e.getTime())/(u.getTime()-e.getTime())*100}%`:"-100%"}function Re(a,e){const u=[],r=new Date(a.getFullYear(),a.getMonth(),1),c=e.getTime()-a.getTime();for(;r<=e;){const y=(r.getTime()-a.getTime())/c*100;y>=0&&y<=100&&u.push({label:`${r.getFullYear()}/${r.getMonth()+1}`,left:`${y}%`}),r.setMonth(r.getMonth()+1)}return u}function Ze(a){return a.status==="completed"?"#67c23a":a.progress>=80?"#409eff":a.progress>=40?"#e6a23c":"#909399"}function je(a){return{draft:"草稿",active:"进行中",completed:"已完成",cancelled:"已取消"}[a]??a}function he(a){return{draft:"info",active:"",completed:"success",cancelled:"danger"}[a]??"info"}function Ve(a){return $(a)?new Date(a).toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}):"—"}function Pe(a){if(!a)return"";const e=new Date(a);return isNaN(e.getTime())?"":e.toLocaleString("zh-CN")}return(a,e)=>{const u=f("el-icon"),r=f("el-button"),c=f("el-option"),y=f("el-select"),V=f("el-tag"),I=f("el-input"),p=f("el-form-item"),E=f("el-radio-button"),we=f("el-radio-group"),F=f("el-date-picker"),ke=f("el-slider"),Ae=f("el-checkbox"),de=f("el-form"),Oe=f("el-popconfirm"),ie=f("el-tab-pane"),O=f("el-table-column"),Xe=f("el-text"),Ce=f("el-switch"),qe=f("el-table"),ze=f("el-empty"),We=f("el-timeline-item"),Ke=f("el-timeline"),Qe=f("el-tabs"),Je=f("el-dialog");return d(),i("div",rt,[n("div",{class:"gs-sidebar",style:T({width:le.value+"px"})},[n("div",mt,[e[32]||(e[32]=n("span",{class:"sidebar-title"},"目标规划",-1)),n("div",ct,[l(r,{size:"small",circle:"",onClick:H},{default:s(()=>[l(u,null,{default:s(()=>[l(w(st))]),_:1})]),_:1}),l(r,{size:"small",type:"primary",circle:"",onClick:_e},{default:s(()=>[l(u,null,{default:s(()=>[l(w(X))]),_:1})]),_:1})])]),n("div",pt,[l(y,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=t=>q.value=t),placeholder:"所有状态",clearable:"",size:"small",class:"filter-sel"},{default:s(()=>[l(c,{label:"草稿",value:"draft"}),l(c,{label:"进行中",value:"active"}),l(c,{label:"已完成",value:"completed"}),l(c,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"]),l(y,{modelValue:W.value,"onUpdate:modelValue":e[1]||(e[1]=t=>W.value=t),placeholder:"所有成员",clearable:"",size:"small",class:"filter-sel"},{default:s(()=>[(d(!0),i(h,null,A(U.value,t=>(d(),x(c,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n("div",vt,[P.value.length===0?(d(),i("div",ft,"暂无目标")):D("",!0),(d(!0),i(h,null,A(P.value,t=>(d(),i("div",{key:t.id,class:ee(["goal-item",{active:m.value?.id===t.id}]),onClick:v=>ge(t)},[n("div",_t,[n("span",yt,_(t.title),1),l(V,{type:he(t.status),size:"small",effect:"plain"},{default:s(()=>[g(_(je(t.status)),1)]),_:2},1032,["type"])]),n("div",bt,[n("div",{class:"gi-progress-bar",style:T({width:t.progress+"%",background:Ze(t)})},null,4),n("span",ht,_(t.progress)+"%",1)]),n("div",Vt,[n("div",wt,[(d(!0),i(h,null,A((t.agentIds||[]).slice(0,3),v=>(d(),i("div",{key:v,class:"gi-avatar",style:T({background:Y.value[v]||"#6366f1"})},_((j.value[v]||v)[0]),5))),128)),(t.agentIds||[]).length>3?(d(),i("span",kt,"+"+_(t.agentIds.length-3),1)):D("",!0)]),n("span",At,_(Ve(t.startAt))+" — "+_(Ve(t.endAt)),1)])],10,gt))),128))])],4),n("div",{class:ee(["gs-handle",{dragging:G.value==="side"}]),onMousedown:e[2]||(e[2]=t=>me(t,"side"))},[...e[33]||(e[33]=[n("div",{class:"gs-handle-bar"},null,-1)])],34),n("div",Ct,[!m.value&&!N.value?(d(),i("div",zt,[n("div",xt,[n("span",Tt,[l(u,{style:{"vertical-align":"-2px","margin-right":"4px"}},{default:s(()=>[l(w(te))]),_:1}),e[34]||(e[34]=g(" 目标总览 · 甘特图 ",-1))]),l(r,{type:"primary",size:"small",onClick:_e},{default:s(()=>[l(u,null,{default:s(()=>[l(w(X))]),_:1}),e[35]||(e[35]=g(" 新建目标 ",-1))]),_:1})]),P.value.length===0?(d(),i("div",Ut,[l(u,{size:"48",color:"#c0c4cc"},{default:s(()=>[l(w(te))]),_:1}),e[36]||(e[36]=n("p",null,"暂无目标，点击新建开始规划",-1))])):(d(),i("div",It,[n("div",Mt,[e[37]||(e[37]=n("div",{class:"gantt-label-col"},null,-1)),n("div",Dt,[n("div",$t,[(d(!0),i(h,null,A(ve.value,t=>(d(),i("div",{key:t.label,class:"gantt-month-label",style:T({left:t.left})},_(t.label),5))),128))]),n("div",Yt,[(d(!0),i(h,null,A(ve.value,t=>(d(),i("div",{key:"l-"+t.label,class:"gantt-grid-line",style:T({left:t.left})},null,4))),128))])])]),n("div",Ht,[e[38]||(e[38]=n("div",{class:"gantt-label-col"},null,-1)),n("div",St,[fe.value!==null?(d(),i("div",{key:0,class:"gantt-today-line",style:T({left:fe.value})},null,4)):D("",!0)])]),(d(!0),i(h,null,A(P.value,t=>(d(),i("div",{key:t.id,class:"gantt-row",onClick:v=>ge(t)},[n("div",Lt,[n("div",Bt,[n("div",Et,[(d(!0),i(h,null,A((t.agentIds||[]).slice(0,2),v=>(d(),i("div",{key:v,class:"gantt-avatar",style:T({background:Y.value[v]||"#409eff"})},_((j.value[v]||v).slice(0,1)),5))),128))]),n("span",Ft,_(t.title),1),l(V,{type:he(t.status),size:"small",effect:"plain",style:{"margin-left":"4px","font-size":"10px"}},{default:s(()=>[g(_(t.progress)+"% ",1)]),_:2},1032,["type"])])]),n("div",Gt,[Be(t)?(d(),i(h,{key:0},[n("div",{class:"gantt-bar",style:T(Fe(t))},[n("div",{class:"gantt-bar-progress",style:T({width:t.progress+"%"})},null,4),Ee(t)>8?(d(),i("span",Rt,_(t.title),1)):D("",!0)],4),(d(!0),i(h,null,A(t.milestones,v=>(d(),i("div",{key:v.id},[$(v.dueAt)?(d(),i("div",{key:0,class:ee(["gantt-milestone",{done:v.done}]),style:T({left:Ge(v)}),title:v.title},null,14,Zt)):D("",!0)]))),128))],64)):(d(),i("div",jt,"未设置时间范围"))])],8,Nt))),128))]))])):N.value?(d(),i(h,{key:1},[n("div",Pt,[n("div",Ot,[l(u,{style:{color:"#909399"}},{default:s(()=>[l(w(te))]),_:1}),e[39]||(e[39]=n("span",{class:"crumb-sep"},"新建",-1)),e[40]||(e[40]=n("span",{class:"crumb-name"},"目标",-1))]),n("div",Xt,[l(r,{size:"small",onClick:e[3]||(e[3]=t=>N.value=!1)},{default:s(()=>[...e[41]||(e[41]=[g("取消",-1)])]),_:1}),l(r,{size:"small",type:"primary",loading:K.value,onClick:ye},{default:s(()=>[l(u,null,{default:s(()=>[l(w(xe))]),_:1}),e[42]||(e[42]=g(" 创建 ",-1))]),_:1},8,["loading"])])]),n("div",qt,[l(de,{model:o,"label-width":"90px",size:"small",class:"goal-inner-form"},{default:s(()=>[l(p,{label:"标题",required:""},{default:s(()=>[l(I,{modelValue:o.title,"onUpdate:modelValue":e[4]||(e[4]=t=>o.title=t),placeholder:"目标标题"},null,8,["modelValue"])]),_:1}),l(p,{label:"描述"},{default:s(()=>[l(I,{modelValue:o.description,"onUpdate:modelValue":e[5]||(e[5]=t=>o.description=t),type:"textarea",rows:2,placeholder:"（可选）"},null,8,["modelValue"])]),_:1}),l(p,{label:"类型"},{default:s(()=>[l(we,{modelValue:o.type,"onUpdate:modelValue":e[6]||(e[6]=t=>o.type=t)},{default:s(()=>[l(E,{value:"personal"},{default:s(()=>[...e[43]||(e[43]=[g("个人",-1)])]),_:1}),l(E,{value:"team"},{default:s(()=>[...e[44]||(e[44]=[g("团队",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"参与成员"},{default:s(()=>[l(y,{modelValue:o.agentIds,"onUpdate:modelValue":e[7]||(e[7]=t=>o.agentIds=t),multiple:"",placeholder:"选择成员",style:{width:"100%"}},{default:s(()=>[(d(!0),i(h,null,A(U.value,t=>(d(),x(c,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"状态"},{default:s(()=>[l(y,{modelValue:o.status,"onUpdate:modelValue":e[8]||(e[8]=t=>o.status=t),style:{width:"100%"}},{default:s(()=>[l(c,{label:"草稿",value:"draft"}),l(c,{label:"进行中",value:"active"}),l(c,{label:"已完成",value:"completed"}),l(c,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"开始时间"},{default:s(()=>[l(F,{modelValue:o.startAt,"onUpdate:modelValue":e[9]||(e[9]=t=>o.startAt=t),type:"datetime",placeholder:"选择开始时间",style:{width:"100%"},"value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue"])]),_:1}),l(p,{label:"结束时间"},{default:s(()=>[l(F,{modelValue:o.endAt,"onUpdate:modelValue":e[10]||(e[10]=t=>o.endAt=t),type:"datetime",placeholder:"选择结束时间",style:{width:"100%"},"value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue"])]),_:1}),m.value?(d(),x(p,{key:0,label:"进度"},{default:s(()=>[l(ke,{modelValue:o.progress,"onUpdate:modelValue":e[11]||(e[11]=t=>o.progress=t),min:0,max:100,"show-input":""},null,8,["modelValue"])]),_:1})):D("",!0),l(p,{label:"里程碑"},{default:s(()=>[n("div",Wt,[(d(!0),i(h,null,A(o.milestones,(t,v)=>(d(),i("div",{key:v,class:"milestone-row"},[l(Ae,{modelValue:t.done,"onUpdate:modelValue":z=>t.done=z},null,8,["modelValue","onUpdate:modelValue"]),l(I,{modelValue:t.title,"onUpdate:modelValue":z=>t.title=z,placeholder:"里程碑标题",size:"small",style:{flex:"1"}},null,8,["modelValue","onUpdate:modelValue"]),l(F,{modelValue:t.dueAt,"onUpdate:modelValue":z=>t.dueAt=z,type:"date",placeholder:"截止日",size:"small",style:{width:"130px"},"value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue","onUpdate:modelValue"]),l(r,{type:"danger",size:"small",circle:"",onClick:z=>o.milestones.splice(v,1)},{default:s(()=>[l(u,null,{default:s(()=>[l(w(ue))]),_:1})]),_:1},8,["onClick"])]))),128)),l(r,{size:"small",onClick:be,style:{"margin-top":"4px"}},{default:s(()=>[l(u,null,{default:s(()=>[l(w(X))]),_:1}),e[45]||(e[45]=g(" 添加里程碑 ",-1))]),_:1})])]),_:1})]),_:1},8,["model"])])],64)):m.value?(d(),i(h,{key:2},[n("div",Kt,[n("div",Qt,[l(u,{style:{color:"#909399"}},{default:s(()=>[l(w(te))]),_:1}),e[46]||(e[46]=n("span",{class:"crumb-sep"},"目标",-1)),n("span",Jt,_(m.value.title),1)]),n("div",el,[l(r,{size:"small",type:"primary",loading:K.value,onClick:ye},{default:s(()=>[l(u,null,{default:s(()=>[l(w(xe))]),_:1}),e[47]||(e[47]=g(" 保存 ",-1))]),_:1},8,["loading"]),l(Oe,{title:`确认删除「${m.value.title}」？`,onConfirm:Me},{reference:s(()=>[l(r,{size:"small",type:"danger",plain:""},{default:s(()=>[l(u,null,{default:s(()=>[l(w(ue))]),_:1})]),_:1})]),_:1},8,["title"])])]),l(Qe,{modelValue:R.value,"onUpdate:modelValue":e[20]||(e[20]=t=>R.value=t),class:"editor-tabs"},{default:s(()=>[l(ie,{label:"基本信息",name:"basic"},{default:s(()=>[n("div",tl,[l(de,{model:o,"label-width":"90px",size:"small",class:"goal-inner-form"},{default:s(()=>[l(p,{label:"标题",required:""},{default:s(()=>[l(I,{modelValue:o.title,"onUpdate:modelValue":e[12]||(e[12]=t=>o.title=t),placeholder:"目标标题"},null,8,["modelValue"])]),_:1}),l(p,{label:"描述"},{default:s(()=>[l(I,{modelValue:o.description,"onUpdate:modelValue":e[13]||(e[13]=t=>o.description=t),type:"textarea",rows:2,placeholder:"（可选）"},null,8,["modelValue"])]),_:1}),l(p,{label:"类型"},{default:s(()=>[l(we,{modelValue:o.type,"onUpdate:modelValue":e[14]||(e[14]=t=>o.type=t)},{default:s(()=>[l(E,{value:"personal"},{default:s(()=>[...e[48]||(e[48]=[g("个人",-1)])]),_:1}),l(E,{value:"team"},{default:s(()=>[...e[49]||(e[49]=[g("团队",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"参与成员"},{default:s(()=>[l(y,{modelValue:o.agentIds,"onUpdate:modelValue":e[15]||(e[15]=t=>o.agentIds=t),multiple:"",placeholder:"选择成员",style:{width:"100%"}},{default:s(()=>[(d(!0),i(h,null,A(U.value,t=>(d(),x(c,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"状态"},{default:s(()=>[l(y,{modelValue:o.status,"onUpdate:modelValue":e[16]||(e[16]=t=>o.status=t),style:{width:"100%"}},{default:s(()=>[l(c,{label:"草稿",value:"draft"}),l(c,{label:"进行中",value:"active"}),l(c,{label:"已完成",value:"completed"}),l(c,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"开始时间"},{default:s(()=>[l(F,{modelValue:o.startAt,"onUpdate:modelValue":e[17]||(e[17]=t=>o.startAt=t),type:"datetime",placeholder:"选择开始时间",style:{width:"100%"},"value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue"])]),_:1}),l(p,{label:"结束时间"},{default:s(()=>[l(F,{modelValue:o.endAt,"onUpdate:modelValue":e[18]||(e[18]=t=>o.endAt=t),type:"datetime",placeholder:"选择结束时间",style:{width:"100%"},"value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue"])]),_:1}),m.value?(d(),x(p,{key:0,label:"进度"},{default:s(()=>[l(ke,{modelValue:o.progress,"onUpdate:modelValue":e[19]||(e[19]=t=>o.progress=t),min:0,max:100,"show-input":""},null,8,["modelValue"])]),_:1})):D("",!0),l(p,{label:"里程碑"},{default:s(()=>[n("div",ll,[(d(!0),i(h,null,A(o.milestones,(t,v)=>(d(),i("div",{key:v,class:"milestone-row"},[l(Ae,{modelValue:t.done,"onUpdate:modelValue":z=>t.done=z},null,8,["modelValue","onUpdate:modelValue"]),l(I,{modelValue:t.title,"onUpdate:modelValue":z=>t.title=z,placeholder:"里程碑标题",size:"small",style:{flex:"1"}},null,8,["modelValue","onUpdate:modelValue"]),l(F,{modelValue:t.dueAt,"onUpdate:modelValue":z=>t.dueAt=z,type:"date",placeholder:"截止日",size:"small",style:{width:"130px"},"value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue","onUpdate:modelValue"]),l(r,{type:"danger",size:"small",circle:"",onClick:z=>o.milestones.splice(v,1)},{default:s(()=>[l(u,null,{default:s(()=>[l(w(ue))]),_:1})]),_:1},8,["onClick"])]))),128)),l(r,{size:"small",onClick:be,style:{"margin-top":"4px"}},{default:s(()=>[l(u,null,{default:s(()=>[l(w(X))]),_:1}),e[50]||(e[50]=g(" 添加里程碑 ",-1))]),_:1})])]),_:1})]),_:1},8,["model"])])]),_:1}),l(ie,{label:"定期检查",name:"checks"},{default:s(()=>[n("div",al,[n("div",sl,[l(r,{type:"primary",size:"small",onClick:De},{default:s(()=>[l(u,null,{default:s(()=>[l(w(X))]),_:1}),e[51]||(e[51]=g(" 添加检查 ",-1))]),_:1})]),l(qe,{data:m.value.checks,size:"small",stripe:"",class:"checks-table"},{default:s(()=>[l(O,{prop:"name",label:"名称","min-width":"120"}),l(O,{label:"频率","min-width":"140"},{default:s(({row:t})=>[n("code",nl,_(t.schedule),1),l(Xe,{type:"info",size:"small",style:{"margin-left":"4px"}},{default:s(()=>[g(_(t.tz||"Asia/Shanghai"),1)]),_:2},1024)]),_:1}),l(O,{label:"成员",width:"90"},{default:s(({row:t})=>[g(_(j.value[t.agentId]||t.agentId),1)]),_:1}),l(O,{label:"启用",width:"60"},{default:s(({row:t})=>[l(Ce,{modelValue:t.enabled,"onUpdate:modelValue":v=>t.enabled=v,size:"small",onChange:v=>He(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(O,{label:"操作",width:"130"},{default:s(({row:t})=>[l(r,{size:"small",link:"",onClick:v=>Se(t)},{default:s(()=>[...e[52]||(e[52]=[g("立即运行",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",link:"",type:"danger",onClick:v=>Ne(t)},{default:s(()=>[...e[53]||(e[53]=[g("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),m.value.checks?.length?D("",!0):(d(),x(ze,{key:0,description:"暂无检查计划","image-size":60}))])]),_:1}),l(ie,{label:"检查记录",name:"records"},{default:s(()=>[n("div",ol,[oe.value?(d(),i("div",dl,[l(u,{class:"is-loading",size:"24"},{default:s(()=>[l(w(nt))]),_:1})])):Q.value.length?(d(),x(Ke,{key:1,class:"records-timeline"},{default:s(()=>[(d(!0),i(h,null,A(Q.value,t=>(d(),x(We,{key:t.id,timestamp:Pe(t.runAt),type:t.status==="ok"?"success":"danger",placement:"top"},{default:s(()=>[n("div",il,[n("div",ul,[n("div",{class:"rec-avatar",style:T({background:Y.value[t.agentId]||"#409eff"})},_((j.value[t.agentId]||"?")[0]),5),n("span",rl,_(j.value[t.agentId]||t.agentId),1),l(V,{type:t.status==="ok"?"success":"danger",size:"small"},{default:s(()=>[g(_(t.status),1)]),_:2},1032,["type"])]),n("div",ml,_(t.output||"（无输出）"),1)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(d(),x(ze,{key:2,description:"暂无检查记录","image-size":60}))])]),_:1})]),_:1},8,["modelValue"])],64)):D("",!0)]),n("div",{class:ee(["gs-handle",{dragging:G.value==="chat"}]),onMousedown:e[21]||(e[21]=t=>me(t,"chat"))},[...e[54]||(e[54]=[n("div",{class:"gs-handle-bar"},null,-1)])],34),n("div",{class:"gs-chat",style:T({width:ae.value+"px"})},[n("div",cl,[l(u,null,{default:s(()=>[l(w(ot))]),_:1}),e[55]||(e[55]=n("span",null,"AI 目标助手",-1)),l(y,{modelValue:L.value,"onUpdate:modelValue":e[22]||(e[22]=t=>L.value=t),size:"small",style:{"margin-left":"auto",width:"110px"},placeholder:"选择成员"},{default:s(()=>[(d(!0),i(h,null,A(U.value,t=>(d(),x(c,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n("div",pl,[L.value?(d(),x(it,{key:L.value,"agent-id":L.value,context:Ue.value,"welcome-message":"你好！我可以帮你创建和管理目标。比如：「帮我创建一个Q2增长目标，让引引负责，3月到6月，每周检查一次」",examples:["帮我创建一个团队目标：Q2用户增长，3月1日到6月30日","给当前目标添加3个里程碑","设置每周一检查进度"],height:"100%",onResponse:Le},null,8,["agent-id","context"])):D("",!0)])],4),l(Je,{modelValue:Z.value,"onUpdate:modelValue":e[31]||(e[31]=t=>Z.value=t),title:"添加定期检查",width:"480px"},{footer:s(()=>[l(r,{onClick:e[30]||(e[30]=t=>Z.value=!1)},{default:s(()=>[...e[57]||(e[57]=[g("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:Ye},{default:s(()=>[...e[58]||(e[58]=[g("添加",-1)])]),_:1})]),default:s(()=>[l(de,{model:b,"label-width":"90px",size:"small"},{default:s(()=>[l(p,{label:"名称",required:""},{default:s(()=>[l(I,{modelValue:b.name,"onUpdate:modelValue":e[23]||(e[23]=t=>b.name=t),placeholder:"如：每周进度检查"},null,8,["modelValue"])]),_:1}),l(p,{label:"执行成员",required:""},{default:s(()=>[l(y,{modelValue:b.agentId,"onUpdate:modelValue":e[24]||(e[24]=t=>b.agentId=t),style:{width:"100%"}},{default:s(()=>[(d(!0),i(h,null,A(U.value,t=>(d(),x(c,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"检查频率"},{default:s(()=>[l(y,{modelValue:J.value,"onUpdate:modelValue":e[25]||(e[25]=t=>J.value=t),style:{width:"100%"},onChange:$e},{default:s(()=>[l(c,{label:"每天上午9点",value:"0 9 * * *"}),l(c,{label:"每周一上午9点",value:"0 9 * * 1"}),l(c,{label:"每周五下午5点",value:"0 17 * * 5"}),l(c,{label:"每月1日上午9点",value:"0 9 1 * *"}),l(c,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),J.value==="custom"?(d(),x(p,{key:0,label:"Cron"},{default:s(()=>[l(I,{modelValue:b.schedule,"onUpdate:modelValue":e[26]||(e[26]=t=>b.schedule=t),placeholder:"0 9 * * 1"},null,8,["modelValue"])]),_:1})):D("",!0),l(p,{label:"时区"},{default:s(()=>[l(y,{modelValue:b.tz,"onUpdate:modelValue":e[27]||(e[27]=t=>b.tz=t),style:{width:"100%"}},{default:s(()=>[l(c,{label:"Asia/Shanghai",value:"Asia/Shanghai"}),l(c,{label:"UTC",value:"UTC"}),l(c,{label:"America/New_York",value:"America/New_York"})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"检查提示词"},{default:s(()=>[l(I,{modelValue:b.prompt,"onUpdate:modelValue":e[28]||(e[28]=t=>b.prompt=t),type:"textarea",rows:3,placeholder:"可用变量：{goal.title} {goal.progress} {goal.endAt}"},null,8,["modelValue"]),e[56]||(e[56]=n("div",{style:{"font-size":"11px",color:"#94a3b8","margin-top":"3px"}}," 变量：{goal.title} {goal.progress} {goal.endAt} {goal.startAt} {goal.status} ",-1))]),_:1}),l(p,{label:"启用"},{default:s(()=>[l(Ce,{modelValue:b.enabled,"onUpdate:modelValue":e[29]||(e[29]=t=>b.enabled=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),bl=ut(vl,[["__scopeId","data-v-96ec97c0"]]);export{bl as default};
